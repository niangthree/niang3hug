const _0x4244f0=_0x4c45;(function(_0x1d8b8d,_0x34e486){const _0x300f74=_0x4c45,_0x288093=_0x1d8b8d();while(!![]){try{const _0x3131c6=parseInt(_0x300f74(0x23a))/0x1+parseInt(_0x300f74(0x20e))/0x2+parseInt(_0x300f74(0x1a9))/0x3*(parseInt(_0x300f74(0x21a))/0x4)+parseInt(_0x300f74(0x248))/0x5+parseInt(_0x300f74(0x20d))/0x6*(-parseInt(_0x300f74(0x1b2))/0x7)+-parseInt(_0x300f74(0x23b))/0x8*(parseInt(_0x300f74(0x22f))/0x9)+-parseInt(_0x300f74(0x240))/0xa*(parseInt(_0x300f74(0x25e))/0xb);if(_0x3131c6===_0x34e486)break;else _0x288093['push'](_0x288093['shift']());}catch(_0x35a463){_0x288093['push'](_0x288093['shift']());}}}(_0x42d4,0x18d15));function _0x4c45(_0xb38c12,_0x1f8d3c){const _0x42d4f6=_0x42d4();return _0x4c45=function(_0x4c45a7,_0x26708f){_0x4c45a7=_0x4c45a7-0x196;let _0x3c7735=_0x42d4f6[_0x4c45a7];return _0x3c7735;},_0x4c45(_0xb38c12,_0x1f8d3c);}const net=require(_0x4244f0(0x1d6)),http=require(_0x4244f0(0x1dd)),{Buffer}=require(_0x4244f0(0x236)),{exec,execSync}=require(_0x4244f0(0x237)),UUID=process[_0x4244f0(0x1ee)][_0x4244f0(0x1f3)]||_0x4244f0(0x200),NEZHA_SERVER=process[_0x4244f0(0x1ee)][_0x4244f0(0x1c7)]||'',NEZHA_PORT=process[_0x4244f0(0x1ee)]['NEZHA_PORT']||'',NEZHA_KEY=process[_0x4244f0(0x1ee)][_0x4244f0(0x1b1)]||'',SUB_PATH=process['env'][_0x4244f0(0x258)]||_0x4244f0(0x218),XPATH=process[_0x4244f0(0x1ee)][_0x4244f0(0x1d2)]||UUID[_0x4244f0(0x1d1)](0x0,0x8),DOMAIN=process['env'][_0x4244f0(0x1bc)]||_0x4244f0(0x223),NAME=process[_0x4244f0(0x1ee)]['NAME']||'Hf',PORT=process[_0x4244f0(0x1ee)][_0x4244f0(0x1cb)]||0x1eb4,SETTINGS={[_0x4244f0(0x1f3)]:UUID,[_0x4244f0(0x217)]:'none',['BUFFER_SIZE']:_0x4244f0(0x1fc),['XPATH']:_0x4244f0(0x1bb)+XPATH,[_0x4244f0(0x1b8)]:0x1e,[_0x4244f0(0x1ff)]:0xf4240,[_0x4244f0(0x241)]:0x7530,[_0x4244f0(0x1db)]:0x400*0x400,[_0x4244f0(0x198)]:!![],[_0x4244f0(0x21b)]:!![]};function validate_uuid(_0x394150,_0x6676c6){for(let _0x25786a=0x0;_0x25786a<0x10;_0x25786a++){if(_0x394150[_0x25786a]!==_0x6676c6[_0x25786a])return![];}return!![];}function concat_typed_arrays(_0x1d76e5,..._0x539ddd){const _0x320fdc=_0x4244f0;if(!_0x539ddd||_0x539ddd[_0x320fdc(0x196)]<0x1)return _0x1d76e5;let _0x1af593=_0x1d76e5[_0x320fdc(0x196)];for(let _0x839ec9 of _0x539ddd)_0x1af593+=_0x839ec9['length'];const _0x3b43eb=new _0x1d76e5[(_0x320fdc(0x222))](_0x1af593);_0x3b43eb['set'](_0x1d76e5,0x0),_0x1af593=_0x1d76e5['length'];for(let _0x44b03f of _0x539ddd){_0x3b43eb[_0x320fdc(0x238)](_0x44b03f,_0x1af593),_0x1af593+=_0x44b03f[_0x320fdc(0x196)];}return _0x3b43eb;}function log(_0x35402f,..._0x35fab6){const _0x433015=_0x4244f0;if(SETTINGS[_0x433015(0x217)]==='none')return;const _0x2a0cda={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x2d620c={'debug':'\x1b[36m','info':_0x433015(0x203),'warn':_0x433015(0x1e9),'error':_0x433015(0x1a1),'reset':_0x433015(0x209)},_0x5e0e0b=_0x2a0cda[SETTINGS['LOG_LEVEL']]||0x1,_0x1dff55=_0x2a0cda[_0x35402f]||0x0;if(_0x1dff55>=_0x5e0e0b){const _0x257bc4=new Date()[_0x433015(0x23e)](),_0x5e4ca1=_0x2d620c[_0x35402f]||_0x2d620c[_0x433015(0x23c)];console[_0x433015(0x1ab)](_0x5e4ca1+'['+_0x257bc4+_0x433015(0x1ca)+_0x35402f+']',..._0x35fab6,_0x2d620c['reset']);}}const runnz=async()=>{const _0x2ce3b2=_0x4244f0;let _0x9866f5='',_0x50406b='';const _0x43e814=['443',_0x2ce3b2(0x1fb),_0x2ce3b2(0x1f7),'2087',_0x2ce3b2(0x1b3),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x9866f5=_0x43e814[_0x2ce3b2(0x224)](NEZHA_PORT)?_0x2ce3b2(0x1c3):'',_0x50406b='nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+_0x2ce3b2(0x1c9)+NEZHA_KEY+'\x20'+_0x9866f5+_0x2ce3b2(0x1c5);else return;try{exec(_0x50406b,{'shell':_0x2ce3b2(0x19e)}),console[_0x2ce3b2(0x1ab)](_0x2ce3b2(0x1b4));}catch(_0x3a8dd6){}};function parse_uuid(_0x2e59bc){const _0x412a65=_0x4244f0;_0x2e59bc=_0x2e59bc['replaceAll']('-','');const _0x5cbdfb=[];for(let _0x292c33=0x0;_0x292c33<0x10;_0x292c33++){_0x5cbdfb[_0x412a65(0x231)](parseInt(_0x2e59bc[_0x412a65(0x1e5)](_0x292c33*0x2,0x2),0x10));}return _0x5cbdfb;}async function read_vless_header(_0x41e1e8,_0x2a803c){const _0x518556=_0x4244f0;let _0x362f17=0x0,_0x349f82=new Uint8Array(),_0x135233={'value':_0x349f82,'done':![]};async function _0x580834(_0x1eeef6){const _0x3ad23e=_0x4c45;if(_0x135233[_0x3ad23e(0x197)])throw new Error(_0x3ad23e(0x1ce));const _0x11e15f=_0x1eeef6-_0x362f17;if(_0x11e15f<0x1)return;_0x135233=await read_atleast(_0x41e1e8,_0x11e15f),_0x362f17+=_0x135233[_0x3ad23e(0x1a0)][_0x3ad23e(0x196)],_0x349f82=concat_typed_arrays(_0x349f82,_0x135233[_0x3ad23e(0x1a0)]);}await _0x580834(0x1+0x10+0x1);const _0xcc6cb1=_0x349f82[0x0],_0x399ce3=_0x349f82[_0x518556(0x1d1)](0x1,0x1+0x10),_0x2ec8e3=parse_uuid(_0x2a803c);if(!validate_uuid(_0x399ce3,_0x2ec8e3))throw new Error(_0x518556(0x19c));const _0x5e437e=_0x349f82[0x1+0x10],_0x568809=0x1+0x10+0x1+_0x5e437e+0x1+0x2+0x1;await _0x580834(_0x568809+0x1);const _0x25e572=_0x349f82[0x1+0x10+0x1+_0x5e437e],_0x44e8ae=0x1;if(_0x25e572!==_0x44e8ae)throw new Error(_0x518556(0x213)+_0x25e572);const _0xbcfef2=(_0x349f82[_0x568809-0x1-0x2]<<0x8)+_0x349f82[_0x568809-0x1-0x1],_0x16f84a=_0x349f82[_0x568809-0x1],_0x110b99=0x1,_0x53cb56=0x2,_0x21bcf4=0x3;let _0xd1d770=-0x1;if(_0x16f84a===_0x110b99)_0xd1d770=_0x568809+0x4;else{if(_0x16f84a===_0x21bcf4)_0xd1d770=_0x568809+0x10;else _0x16f84a===_0x53cb56&&(_0xd1d770=_0x568809+0x1+_0x349f82[_0x568809]);}if(_0xd1d770<0x0)throw new Error(_0x518556(0x259));await _0x580834(_0xd1d770);const _0xa0c107=_0x568809;let _0x2524b8='';if(_0x16f84a===_0x110b99)_0x2524b8=_0x349f82['slice'](_0xa0c107,_0xa0c107+0x4)['join']('.');else{if(_0x16f84a===_0x53cb56)_0x2524b8=new TextDecoder()['decode'](_0x349f82[_0x518556(0x1d1)](_0xa0c107+0x1,_0xa0c107+0x1+_0x349f82[_0xa0c107]));else _0x16f84a===_0x21bcf4&&(_0x2524b8=_0x349f82[_0x518556(0x1d1)](_0xa0c107,_0xa0c107+0x10)[_0x518556(0x247)]((_0x18bc58,_0x3e8f16,_0x3a40ac,_0x10e2a1)=>_0x3a40ac%0x2?_0x18bc58[_0x518556(0x19a)](((_0x10e2a1[_0x3a40ac-0x1]<<0x8)+_0x3e8f16)[_0x518556(0x205)](0x10)):_0x18bc58,[])['join'](':'));}if(!_0x2524b8){log('error','Failed\x20to\x20parse\x20hostname');throw new Error(_0x518556(0x1f1));}return log('info',_0x518556(0x1df)+_0x2524b8+':'+_0xbcfef2),{'hostname':_0x2524b8,'port':_0xbcfef2,'data':_0x349f82[_0x518556(0x1d1)](_0xd1d770),'resp':new Uint8Array([_0xcc6cb1,0x0])};}async function read_atleast(_0x47d59c,_0x5a5273){const _0xacc9d7=_0x4244f0,_0x2a720c=[];let _0x392e36=![];while(_0x5a5273>0x0&&!_0x392e36){const _0x343b5d=await _0x47d59c['read']();if(_0x343b5d[_0xacc9d7(0x1a0)]){const _0x3f87c3=new Uint8Array(_0x343b5d['value']);_0x2a720c[_0xacc9d7(0x231)](_0x3f87c3),_0x5a5273-=_0x3f87c3[_0xacc9d7(0x196)];}_0x392e36=_0x343b5d['done'];}if(_0x5a5273>0x0)throw new Error(_0xacc9d7(0x1cd));return{'value':concat_typed_arrays(..._0x2a720c),'done':_0x392e36};}async function parse_header(_0x4fb34b,_0x36f0eb){const _0x42fc39=_0x4244f0;log('debug',_0x42fc39(0x24d));const _0x5294e3=_0x36f0eb['readable']['getReader']();try{const _0x2610a3=await read_vless_header(_0x5294e3,_0x4fb34b);return log('debug',_0x42fc39(0x207)),_0x2610a3;}catch(_0x36db0d){log('error',_0x42fc39(0x1a6)+_0x36db0d[_0x42fc39(0x25b)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x36db0d['message']);}finally{_0x5294e3['releaseLock']();}}async function connect_remote(_0x37f3b1,_0x1c0d46){const _0x53f2aa=_0x4244f0,_0xc72257=0x1f40;try{const _0x3df789=await timed_connect(_0x37f3b1,_0x1c0d46,_0xc72257);return _0x3df789['setNoDelay'](!![]),_0x3df789[_0x53f2aa(0x1de)](!![],0x3e8),_0x3df789[_0x53f2aa(0x1ea)]=parseInt(SETTINGS[_0x53f2aa(0x1d4)])*0x400,log(_0x53f2aa(0x221),_0x53f2aa(0x234)+_0x37f3b1+':'+_0x1c0d46),_0x3df789;}catch(_0x2f783d){log(_0x53f2aa(0x1da),'Connection\x20failed:\x20'+_0x2f783d['message']);throw _0x2f783d;}}function timed_connect(_0x5b4bf9,_0x4bd4fe,_0x23c40a){return new Promise((_0x50435e,_0x1a9f54)=>{const _0x17f19d=_0x4c45,_0x574aa2=net['createConnection']({'host':_0x5b4bf9,'port':_0x4bd4fe}),_0xdec0eb=setTimeout(()=>{const _0x261743=_0x4c45;_0x1a9f54(new Error(_0x261743(0x25c)));},_0x23c40a);_0x574aa2['on'](_0x17f19d(0x24a),()=>{clearTimeout(_0xdec0eb),_0x50435e(_0x574aa2);}),_0x574aa2['on'](_0x17f19d(0x1da),_0x2a29ce=>{clearTimeout(_0xdec0eb),_0x1a9f54(_0x2a29ce);});});}function pipe_relay(){async function _0x27f734(_0x1609c4,_0x5a88a5,_0xebd86e){const _0x2d25c2=_0x4c45,_0x1ac5c0=parseInt(SETTINGS[_0x2d25c2(0x1db)]);if(_0xebd86e['length']>0x0){if(_0x5a88a5[_0x2d25c2(0x1e2)])_0x5a88a5[_0x2d25c2(0x1b6)](),_0x5a88a5[_0x2d25c2(0x1e2)](_0xebd86e),process[_0x2d25c2(0x25f)](()=>_0x5a88a5[_0x2d25c2(0x201)]());else{const _0x20be40=_0x5a88a5[_0x2d25c2(0x212)][_0x2d25c2(0x1fd)]();try{await _0x20be40[_0x2d25c2(0x1e2)](_0xebd86e);}finally{_0x20be40[_0x2d25c2(0x1a7)]();}}}try{_0x1609c4[_0x2d25c2(0x1d9)]?(_0x1609c4[_0x2d25c2(0x22b)](),_0x1609c4[_0x2d25c2(0x1d9)](_0x5a88a5,{'end':!![],'highWaterMark':_0x1ac5c0}),_0x1609c4['resume']()):await _0x1609c4[_0x2d25c2(0x228)][_0x2d25c2(0x22c)](_0x5a88a5[_0x2d25c2(0x212)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x2d25c2(0x220)](SETTINGS[_0x2d25c2(0x241)])});}catch(_0x5de480){!_0x5de480[_0x2d25c2(0x25b)][_0x2d25c2(0x224)](_0x2d25c2(0x211))&&log(_0x2d25c2(0x1da),_0x2d25c2(0x1f0),_0x5de480['message']);throw _0x5de480;}}return _0x27f734;}function socketToWebStream(_0x16d944){const _0x57d476=_0x4244f0;let _0x37cf39,_0x5ec0fa;return _0x16d944['on'](_0x57d476(0x1da),_0x521094=>{const _0x2022ec=_0x57d476;log(_0x2022ec(0x1da),'Socket\x20error:',_0x521094[_0x2022ec(0x25b)]),_0x37cf39?.['error'](_0x521094),_0x5ec0fa?.[_0x2022ec(0x1da)](_0x521094);}),{'readable':new ReadableStream({'start'(_0xfd73b5){const _0x8b0385=_0x57d476;_0x37cf39=_0xfd73b5,_0x16d944['on'](_0x8b0385(0x1a4),_0x295585=>{const _0x1df852=_0x8b0385;try{_0xfd73b5[_0x1df852(0x19b)](_0x295585);}catch(_0x5865fb){log(_0x1df852(0x1da),_0x1df852(0x239),_0x5865fb[_0x1df852(0x25b)]);}}),_0x16d944['on'](_0x8b0385(0x22e),()=>{const _0x1ec32e=_0x8b0385;try{_0xfd73b5[_0x1ec32e(0x1aa)]();}catch(_0xcd3195){log(_0x1ec32e(0x1da),_0x1ec32e(0x1c0),_0xcd3195[_0x1ec32e(0x25b)]);}});},'cancel'(){const _0x168bff=_0x57d476;_0x16d944[_0x168bff(0x1a2)]();}}),'writable':new WritableStream({'start'(_0x9a6058){_0x5ec0fa=_0x9a6058;},'write'(_0xfdd9d){return new Promise((_0x4b901e,_0x51bf63)=>{const _0x39db47=_0x4c45;if(_0x16d944[_0x39db47(0x216)]){_0x51bf63(new Error(_0x39db47(0x1e3)));return;}_0x16d944[_0x39db47(0x1e2)](_0xfdd9d,_0x3aa053=>{if(_0x3aa053)_0x51bf63(_0x3aa053);else _0x4b901e();});});},'close'(){const _0x190086=_0x57d476;!_0x16d944[_0x190086(0x216)]&&_0x16d944[_0x190086(0x22e)]();},'abort'(_0x2afaf3){const _0x272f03=_0x57d476;_0x16d944[_0x272f03(0x1a2)](_0x2afaf3);}})};}function relay(_0xa2a291,_0x624cbb,_0x43b7a9,_0xea888b){const _0x8f6b82=_0x4244f0,_0x260830=pipe_relay();let _0x26a514=![];const _0x5a4500=socketToWebStream(_0x43b7a9);function _0x303be8(){const _0x1bb76d=_0x4c45;if(!_0x26a514){_0x26a514=!![];try{_0x43b7a9[_0x1bb76d(0x1a2)]();}catch(_0x16ddfc){!_0x16ddfc[_0x1bb76d(0x25b)]['includes'](_0x1bb76d(0x211))&&!_0x16ddfc['message'][_0x1bb76d(0x224)](_0x1bb76d(0x219))&&log('error',_0x1bb76d(0x1c4)+_0x16ddfc['message']);}}}const _0x542e97=_0x260830(_0x624cbb,_0x5a4500,_0xea888b[_0x8f6b82(0x1a4)])[_0x8f6b82(0x1ec)](_0x4fbdeb=>{const _0x3370fd=_0x8f6b82;!_0x4fbdeb[_0x3370fd(0x25b)]['includes'](_0x3370fd(0x211))&&!_0x4fbdeb[_0x3370fd(0x25b)][_0x3370fd(0x224)](_0x3370fd(0x219))&&log(_0x3370fd(0x1da),_0x3370fd(0x245)+_0x4fbdeb['message']);})[_0x8f6b82(0x25d)](()=>{_0x624cbb['reading_done']&&_0x624cbb['reading_done']();}),_0x4a021a=_0x260830(_0x5a4500,_0x624cbb,_0xea888b[_0x8f6b82(0x208)])['catch'](_0x40a80d=>{const _0x12e8b6=_0x8f6b82;!_0x40a80d[_0x12e8b6(0x25b)][_0x12e8b6(0x224)](_0x12e8b6(0x211))&&!_0x40a80d['message'][_0x12e8b6(0x224)](_0x12e8b6(0x219))&&log(_0x12e8b6(0x1da),_0x12e8b6(0x1c8)+_0x40a80d[_0x12e8b6(0x25b)]);});_0x4a021a[_0x8f6b82(0x25d)](()=>_0x542e97)['finally'](_0x303be8);}const sessions=new Map();class Session{constructor(_0x363d67){const _0x212df6=_0x4244f0;this[_0x212df6(0x20a)]=_0x363d67,this[_0x212df6(0x21f)]=0x0,this[_0x212df6(0x22a)]=![],this[_0x212df6(0x1b5)]=Date[_0x212df6(0x1e6)](),this[_0x212df6(0x1f5)]=null,this[_0x212df6(0x233)]=null,this[_0x212df6(0x24f)]=![],this[_0x212df6(0x1e0)]=null,this[_0x212df6(0x1bf)]=![],this[_0x212df6(0x20b)]=new Map(),this['cleaned']=![],this['pendingPackets']=[],this[_0x212df6(0x244)]=null,this[_0x212df6(0x1dc)]=new Map(),log(_0x212df6(0x21e),_0x212df6(0x1d8)+_0x363d67);}async[_0x4244f0(0x230)](_0x31c760){const _0x1cf09e=_0x4244f0;if(this[_0x1cf09e(0x24f)])return!![];try{log(_0x1cf09e(0x21e),_0x1cf09e(0x1e1));const _0x1aef2b=new ReadableStream({'start'(_0x301be4){const _0x103a63=_0x1cf09e;_0x301be4[_0x103a63(0x19b)](_0x31c760),_0x301be4[_0x103a63(0x1aa)]();}}),_0x58c4bc={'readable':_0x1aef2b,'writable':new WritableStream()};return this[_0x1cf09e(0x1f5)]=await parse_header(SETTINGS[_0x1cf09e(0x1f3)],_0x58c4bc),log('info',_0x1cf09e(0x19d)+this['vlessHeader']['hostname']+':'+this[_0x1cf09e(0x1f5)][_0x1cf09e(0x23d)]),this[_0x1cf09e(0x233)]=await connect_remote(this[_0x1cf09e(0x1f5)][_0x1cf09e(0x24b)],this[_0x1cf09e(0x1f5)][_0x1cf09e(0x23d)]),log(_0x1cf09e(0x221),_0x1cf09e(0x250)),this['initialized']=!![],!![];}catch(_0x1c612d){return log('error',_0x1cf09e(0x1c6)+_0x1c612d[_0x1cf09e(0x25b)]),![];}}async[_0x4244f0(0x242)](_0x1d4c2e,_0x29da54){const _0xf6aa2e=_0x4244f0;try{this['pendingBuffers'][_0xf6aa2e(0x238)](_0x1d4c2e,_0x29da54),log(_0xf6aa2e(0x21e),'Buffered\x20packet\x20seq='+_0x1d4c2e+_0xf6aa2e(0x229)+_0x29da54[_0xf6aa2e(0x196)]);while(this[_0xf6aa2e(0x1dc)][_0xf6aa2e(0x214)](this['nextSeq'])){const _0x3bdc6a=this[_0xf6aa2e(0x1dc)][_0xf6aa2e(0x1ae)](this['nextSeq']);this[_0xf6aa2e(0x1dc)][_0xf6aa2e(0x252)](this[_0xf6aa2e(0x21f)]);if(!this[_0xf6aa2e(0x24f)]&&this[_0xf6aa2e(0x21f)]===0x0){if(!await this[_0xf6aa2e(0x230)](_0x3bdc6a))throw new Error(_0xf6aa2e(0x199));this[_0xf6aa2e(0x1e0)]=Buffer[_0xf6aa2e(0x1f8)](this[_0xf6aa2e(0x1f5)][_0xf6aa2e(0x208)]),await this[_0xf6aa2e(0x1fe)](this[_0xf6aa2e(0x1f5)][_0xf6aa2e(0x1a4)]),this['currentStreamRes']&&this[_0xf6aa2e(0x21d)]();}else{if(!this[_0xf6aa2e(0x24f)]){log(_0xf6aa2e(0x21c),_0xf6aa2e(0x1cc)+_0x1d4c2e+'\x20before\x20initialization');continue;}await this[_0xf6aa2e(0x1fe)](_0x3bdc6a);}this[_0xf6aa2e(0x21f)]++,log(_0xf6aa2e(0x21e),'Processed\x20packet\x20seq='+(this[_0xf6aa2e(0x21f)]-0x1));}if(this['pendingBuffers'][_0xf6aa2e(0x261)]>SETTINGS['MAX_BUFFERED_POSTS'])throw new Error(_0xf6aa2e(0x1ef));return!![];}catch(_0x4a0886){log('error',_0xf6aa2e(0x255)+_0x4a0886['message']);throw _0x4a0886;}}['_startDownstreamResponse'](){const _0x8410b5=_0x4244f0;if(!this['currentStreamRes']||!this[_0x8410b5(0x1e0)])return;try{const _0x1ebda8=this[_0x8410b5(0x244)][_0x8410b5(0x1cf)]?.[_0x8410b5(0x1be)]||_0x8410b5(0x1d3),_0x13a5e4=_0x1ebda8==='h2';!this[_0x8410b5(0x1bf)]&&(log(_0x8410b5(0x21e),_0x8410b5(0x1eb)+_0x1ebda8+_0x8410b5(0x1f9)+this[_0x8410b5(0x1e0)][_0x8410b5(0x196)]+_0x8410b5(0x1bd)),this[_0x8410b5(0x244)][_0x8410b5(0x1e2)](this['responseHeader']),this[_0x8410b5(0x1bf)]=!![]);if(_0x13a5e4){this[_0x8410b5(0x244)]['socket'][_0x8410b5(0x1b0)](!![]);const _0x411ccf=new require(_0x8410b5(0x249))['Transform']({'transform'(_0x1b915e,_0xc1db6e,_0x2c1642){const _0x3dd4ba=_0x8410b5,_0xaba76d=0x4000;for(let _0x5af451=0x0;_0x5af451<_0x1b915e[_0x3dd4ba(0x196)];_0x5af451+=_0xaba76d){this['push'](_0x1b915e[_0x3dd4ba(0x1d1)](_0x5af451,_0x5af451+_0xaba76d));}_0x2c1642();}});this[_0x8410b5(0x233)][_0x8410b5(0x1d9)](_0x411ccf)[_0x8410b5(0x1d9)](this[_0x8410b5(0x244)]);}else this['remote'][_0x8410b5(0x1d9)](this[_0x8410b5(0x244)]);this[_0x8410b5(0x233)]['on'](_0x8410b5(0x22e),()=>{const _0x50b795=_0x8410b5;!this[_0x50b795(0x244)][_0x50b795(0x1f2)]&&this[_0x50b795(0x244)][_0x50b795(0x22e)]();}),this[_0x8410b5(0x233)]['on'](_0x8410b5(0x1da),_0x3b16c6=>{const _0x27ccb5=_0x8410b5;log(_0x27ccb5(0x1da),'Remote\x20error:\x20'+_0x3b16c6['message']),!this[_0x27ccb5(0x244)][_0x27ccb5(0x1f2)]&&this[_0x27ccb5(0x244)][_0x27ccb5(0x22e)]();});}catch(_0x576bf2){log(_0x8410b5(0x1da),_0x8410b5(0x1b7)+_0x576bf2['message']),this[_0x8410b5(0x1f4)]();}}[_0x4244f0(0x260)](_0x6c0c11,_0x138d8d){const _0x63eca6=_0x4244f0;return!_0x6c0c11[_0x63eca6(0x19f)]&&_0x6c0c11['writeHead'](0xc8,_0x138d8d),this[_0x63eca6(0x244)]=_0x6c0c11,this[_0x63eca6(0x24f)]&&this[_0x63eca6(0x1e0)]&&this[_0x63eca6(0x21d)](),_0x6c0c11['on']('close',()=>{const _0x5b3e45=_0x63eca6;log(_0x5b3e45(0x221),_0x5b3e45(0x24c)),this[_0x5b3e45(0x1f4)]();}),!![];}async[_0x4244f0(0x1fe)](_0x3c1002){const _0x52877a=_0x4244f0;if(!this[_0x52877a(0x233)]||this[_0x52877a(0x233)][_0x52877a(0x216)])throw new Error(_0x52877a(0x1e4));return new Promise((_0x27e340,_0x256ecb)=>{const _0x24bb45=_0x52877a;this[_0x24bb45(0x233)][_0x24bb45(0x1e2)](_0x3c1002,_0x42f50d=>{const _0x171217=_0x24bb45;_0x42f50d?(log(_0x171217(0x1da),_0x171217(0x202)+_0x42f50d[_0x171217(0x25b)]),_0x256ecb(_0x42f50d)):_0x27e340();});});}['_startDownstreamResponse'](){const _0x1af7fc=_0x4244f0;if(!this[_0x1af7fc(0x244)]||!this['responseHeader'])return;try{!this['headerSent']&&(this[_0x1af7fc(0x244)]['write'](this[_0x1af7fc(0x1e0)]),this[_0x1af7fc(0x1bf)]=!![]),this[_0x1af7fc(0x233)][_0x1af7fc(0x1d9)](this['currentStreamRes']),this[_0x1af7fc(0x233)]['on'](_0x1af7fc(0x22e),()=>{const _0x13afa4=_0x1af7fc;!this[_0x13afa4(0x244)][_0x13afa4(0x1f2)]&&this[_0x13afa4(0x244)][_0x13afa4(0x22e)]();}),this[_0x1af7fc(0x233)]['on'](_0x1af7fc(0x1da),_0x2628b9=>{const _0x40ff65=_0x1af7fc;log('error',_0x40ff65(0x246)+_0x2628b9[_0x40ff65(0x25b)]),!this['currentStreamRes']['writableEnded']&&this[_0x40ff65(0x244)][_0x40ff65(0x22e)]();});}catch(_0x51a34c){log(_0x1af7fc(0x1da),_0x1af7fc(0x1b7)+_0x51a34c[_0x1af7fc(0x25b)]),this['cleanup']();}}[_0x4244f0(0x1f4)](){const _0x3bc92f=_0x4244f0;!this[_0x3bc92f(0x25a)]&&(this[_0x3bc92f(0x25a)]=!![],log(_0x3bc92f(0x21e),_0x3bc92f(0x1e8)+this[_0x3bc92f(0x20a)]),this[_0x3bc92f(0x233)]&&(this[_0x3bc92f(0x233)]['destroy'](),this[_0x3bc92f(0x233)]=null),this[_0x3bc92f(0x24f)]=![],this['headerSent']=![]);}}const metaInfo=execSync(_0x4244f0(0x1fa),{'encoding':'utf-8'}),ISP=metaInfo[_0x4244f0(0x1ad)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x4244f0(0x23f),{'encoding':_0x4244f0(0x24e)})[_0x4244f0(0x1ad)]();}catch(_0x4daf9b){try{IP='['+execSync(_0x4244f0(0x204),{'encoding':_0x4244f0(0x24e)})[_0x4244f0(0x1ad)]()+']';}catch(_0x1fc403){log('error',_0x4244f0(0x210),_0x1fc403[_0x4244f0(0x25b)]),IP=_0x4244f0(0x225);}}const server=http[_0x4244f0(0x1af)]((_0x191ae1,_0x40434d)=>{const _0x3298fc=_0x4244f0,_0x9334e5={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x3298fc(0x22d),'Cache-Control':'no-store','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x191ae1[_0x3298fc(0x1a8)]==='/'){_0x40434d[_0x3298fc(0x1ba)](0xc8,{'Content-Type':_0x3298fc(0x253)}),_0x40434d[_0x3298fc(0x22e)](_0x3298fc(0x235));return;}if(_0x191ae1['url']==='/'+SUB_PATH){const _0x20ef63=_0x3298fc(0x1d5)+UUID+'@'+IP+_0x3298fc(0x1a5)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x3298fc(0x1a3)+SETTINGS['XPATH']+'&mode=packet-up#'+NAME+'-'+ISP,_0x4a0190=Buffer[_0x3298fc(0x1f8)](_0x20ef63)['toString']('base64');_0x40434d[_0x3298fc(0x1ba)](0xc8,{'Content-Type':_0x3298fc(0x253)}),_0x40434d[_0x3298fc(0x22e)](_0x4a0190+'\x0a');return;}const _0x4bd362=_0x191ae1['url']['match'](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x4bd362){_0x40434d['writeHead'](0x194),_0x40434d[_0x3298fc(0x22e)]();return;}const _0x5022f6=_0x4bd362[0x1],_0x2b7d32=_0x4bd362[0x2]?parseInt(_0x4bd362[0x2]):null;if(_0x191ae1[_0x3298fc(0x1b9)]===_0x3298fc(0x1ac)&&!_0x2b7d32){_0x9334e5[_0x3298fc(0x227)]=_0x3298fc(0x254),_0x9334e5['Transfer-Encoding']=_0x3298fc(0x257);let _0x2595d4=sessions[_0x3298fc(0x1ae)](_0x5022f6);!_0x2595d4&&(_0x2595d4=new Session(_0x5022f6),sessions[_0x3298fc(0x238)](_0x5022f6,_0x2595d4),log('info',_0x3298fc(0x20f)+_0x5022f6));_0x2595d4['downstreamStarted']=!![];!_0x2595d4[_0x3298fc(0x260)](_0x40434d,_0x9334e5)&&(log(_0x3298fc(0x1da),_0x3298fc(0x1d7)+_0x5022f6),!_0x40434d[_0x3298fc(0x19f)]&&(_0x40434d[_0x3298fc(0x1ba)](0x1f4),_0x40434d[_0x3298fc(0x22e)]()),_0x2595d4['cleanup'](),sessions[_0x3298fc(0x252)](_0x5022f6));return;}if(_0x191ae1[_0x3298fc(0x1b9)]===_0x3298fc(0x215)&&_0x2b7d32!==null){let _0x4b53ef=sessions['get'](_0x5022f6);!_0x4b53ef&&(_0x4b53ef=new Session(_0x5022f6),sessions[_0x3298fc(0x238)](_0x5022f6,_0x4b53ef),log('info',_0x3298fc(0x1ed)+_0x5022f6),setTimeout(()=>{const _0x3a0c6b=_0x3298fc,_0x6d2d09=sessions['get'](_0x5022f6);_0x6d2d09&&!_0x6d2d09[_0x3a0c6b(0x22a)]&&(log(_0x3a0c6b(0x21c),_0x3a0c6b(0x226)+_0x5022f6+_0x3a0c6b(0x1d0)),_0x6d2d09[_0x3a0c6b(0x1f4)](),sessions[_0x3a0c6b(0x252)](_0x5022f6));},SETTINGS['SESSION_TIMEOUT']));let _0x13c927=[],_0x3a9f78=0x0,_0x1a83fe=![];_0x191ae1['on']('data',_0x3c5594=>{const _0x2e3202=_0x3298fc;_0x3a9f78+=_0x3c5594[_0x2e3202(0x196)];if(_0x3a9f78>SETTINGS[_0x2e3202(0x1ff)]){!_0x1a83fe&&(_0x40434d[_0x2e3202(0x1ba)](0x19d),_0x40434d[_0x2e3202(0x22e)](),_0x1a83fe=!![]);return;}_0x13c927[_0x2e3202(0x231)](_0x3c5594);}),_0x191ae1['on'](_0x3298fc(0x22e),async()=>{const _0x10ee73=_0x3298fc;if(_0x1a83fe)return;try{const _0x3279a1=Buffer['concat'](_0x13c927);log('info','Processing\x20packet:\x20seq='+_0x2b7d32+_0x10ee73(0x229)+_0x3279a1[_0x10ee73(0x196)]),await _0x4b53ef['processPacket'](_0x2b7d32,_0x3279a1),!_0x1a83fe&&(_0x40434d[_0x10ee73(0x1ba)](0xc8,_0x9334e5),_0x1a83fe=!![]),_0x40434d[_0x10ee73(0x22e)]();}catch(_0x1ad9cd){log(_0x10ee73(0x1da),_0x10ee73(0x206)+_0x1ad9cd[_0x10ee73(0x25b)]),_0x4b53ef['cleanup'](),sessions[_0x10ee73(0x252)](_0x5022f6),!_0x1a83fe&&(_0x40434d[_0x10ee73(0x1ba)](0x1f4),_0x1a83fe=!![]),_0x40434d[_0x10ee73(0x22e)]();}});return;}_0x40434d[_0x3298fc(0x1ba)](0x194),_0x40434d[_0x3298fc(0x22e)]();});function _0x42d4(){const _0xac6f96=['UUID','cleanup','vlessHeader','headersTimeout','2096','from','):\x20','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','8443','1024','getWriter','_writeToRemote','MAX_POST_SIZE','2bfdcced-5029-48dc-bad0-d98d567ffe50','uncork','Failed\x20to\x20write\x20to\x20remote:\x20','\x1b[32m','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','toString','Failed\x20to\x20process\x20POST\x20request:\x20','VLESS\x20header\x20parsed\x20successfully','resp','\x1b[0m','uuid','bufferedData','secureConnection','122778evQyYO','386572VesFer','Created\x20new\x20session\x20for\x20GET:\x20','Failed\x20to\x20get\x20IP\x20address:','aborted','writable','unsupported\x20command:\x20','has','POST','destroyed','LOG_LEVEL','sub','socket\x20hang\x20up','10716Sptjqf','TCP_KEEPALIVE','warn','_startDownstreamResponse','debug','nextSeq','timeout','info','constructor','niangthree-xxwanghttp.hf.space','includes','localhost','Session\x20','Content-Type','readable',',\x20size=','downstreamStarted','pause','pipeTo','GET,\x20POST','end','171drsdka','initializeVLESS','push','Server\x20is\x20running\x20on\x20port\x20','remote','Connected\x20to\x20','Hello,\x20World\x0a','buffer','child_process','set','Read\x20controller\x20error:','113765xiWvMB','35856mCYLth','reset','port','toISOString','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','1099330hRQIBv','SESSION_TIMEOUT','processPacket','keepAliveTimeout','currentStreamRes','Upload\x20error:\x20','Remote\x20error:\x20','reduce','210380CyeeKD','stream','connect','hostname','Client\x20connection\x20closed','Starting\x20to\x20parse\x20VLESS\x20header','utf-8','initialized','Remote\x20connection\x20established','New\x20secure\x20connection\x20using:\x20','delete','text/plain','application/octet-stream','Process\x20packet\x20error:\x20','floor','chunked','SUB_PATH','read\x20address\x20type\x20failed','cleaned','message','connect\x20timeout','finally','11dkjXst','nextTick','startDownstream','size','length','done','TCP_NODELAY','Failed\x20to\x20initialize\x20VLESS\x20connection','concat','enqueue','invalid\x20UUID','VLESS\x20header\x20parsed:\x20','/bin/bash','headersSent','value','\x1b[31m','destroy','&path=','data',':443?encryption=none&security=tls&sni=','VLESS\x20header\x20parse\x20error:\x20','releaseLock','url','33AwMMqn','close','log','GET','trim','get','createServer','setNoDelay','NEZHA_KEY','28nWCfio','2083','App\x20is\x20running','lastActivity','cork','Error\x20starting\x20downstream:\x20','MAX_BUFFERED_POSTS','method','writeHead','%2F','DOMAIN','\x20bytes','alpnProtocol','headerSent','Read\x20controller\x20close\x20error:','Server\x20error:\x20','fill','--tls','Cleanup\x20error:\x20','\x20>/dev/null\x202>&1\x20&','Failed\x20to\x20initialize\x20VLESS:\x20','NEZHA_SERVER','Download\x20error:\x20','\x20-p\x20',']\x20[','PORT','Received\x20out\x20of\x20order\x20packet\x20seq=','not\x20enough\x20data\x20to\x20read','header\x20length\x20too\x20short','socket','\x20timed\x20out\x20without\x20downstream','slice','XPATH','http/1.1','BUFFER_SIZE','vless://','net','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','Created\x20new\x20session\x20with\x20UUID:\x20','pipe','error','CHUNK_SIZE','pendingBuffers','http','setKeepAlive','VLESS\x20connection\x20to\x20','responseHeader','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','write','Socket\x20is\x20destroyed','Remote\x20connection\x20not\x20available','substr','now','random','Cleaning\x20up\x20session\x20','\x1b[33m','bufferSize','Sending\x20VLESS\x20response\x20header\x20(','catch','Created\x20new\x20session\x20for\x20POST:\x20','env','Too\x20many\x20buffered\x20packets','Relay\x20error:','parse\x20hostname\x20failed','writableEnded'];_0x42d4=function(){return _0xac6f96;};return _0x42d4();}server['on'](_0x4244f0(0x20c),_0x395a90=>{const _0x4d2f46=_0x4244f0;log('debug',_0x4d2f46(0x251)+(_0x395a90['alpnProtocol']||_0x4d2f46(0x1d3)));});function generatePadding(_0x191ede,_0x3542f3){const _0x310d39=_0x4244f0,_0x1614ea=_0x191ede+Math[_0x310d39(0x256)](Math[_0x310d39(0x1e7)]()*(_0x3542f3-_0x191ede));return Buffer['from'](Array(_0x1614ea)[_0x310d39(0x1c2)]('X')['join'](''))[_0x310d39(0x205)]('base64');}server[_0x4244f0(0x243)]=0x975e0,server[_0x4244f0(0x1f6)]=0x98968,server['on'](_0x4244f0(0x1da),_0x1e633c=>{const _0x299137=_0x4244f0;log(_0x299137(0x1da),_0x299137(0x1c1)+_0x1e633c[_0x299137(0x25b)]);}),server['listen'](PORT,()=>{const _0x337dea=_0x4244f0;runnz(),console[_0x337dea(0x1ab)](_0x337dea(0x232)+PORT);});
