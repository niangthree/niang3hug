const _0x2955a5=_0x509c;(function(_0x424086,_0x4f3386){const _0x36df42=_0x509c,_0x238daa=_0x424086();while(!![]){try{const _0x46bfd6=parseInt(_0x36df42(0xa3))/0x1+parseInt(_0x36df42(0xce))/0x2*(parseInt(_0x36df42(0xf6))/0x3)+parseInt(_0x36df42(0x95))/0x4+-parseInt(_0x36df42(0xf4))/0x5+parseInt(_0x36df42(0xb2))/0x6*(parseInt(_0x36df42(0xf8))/0x7)+parseInt(_0x36df42(0xa1))/0x8+-parseInt(_0x36df42(0xfd))/0x9;if(_0x46bfd6===_0x4f3386)break;else _0x238daa['push'](_0x238daa['shift']());}catch(_0x439f8f){_0x238daa['push'](_0x238daa['shift']());}}}(_0x12af,0xbd56e));const net=require(_0x2955a5(0x139)),http=require(_0x2955a5(0x10d)),{Buffer}=require(_0x2955a5(0x110)),{exec,execSync}=require('child_process'),UUID=process[_0x2955a5(0xe9)][_0x2955a5(0x10c)]||_0x2955a5(0xb6),NEZHA_SERVER=process[_0x2955a5(0xe9)][_0x2955a5(0xcf)]||'',NEZHA_PORT=process[_0x2955a5(0xe9)][_0x2955a5(0x128)]||'',NEZHA_KEY=process[_0x2955a5(0xe9)][_0x2955a5(0xad)]||'',SUB_PATH=process['env']['SUB_PATH']||_0x2955a5(0x112),XPATH=process[_0x2955a5(0xe9)][_0x2955a5(0xee)]||UUID[_0x2955a5(0xb9)](0x0,0x8),DOMAIN=process['env']['DOMAIN']||_0x2955a5(0x134),NAME=process[_0x2955a5(0xe9)][_0x2955a5(0x8c)]||'Hf',PORT=process[_0x2955a5(0xe9)][_0x2955a5(0x9f)]||0x1eb4,SETTINGS={[_0x2955a5(0x10c)]:UUID,[_0x2955a5(0xa9)]:'none',[_0x2955a5(0xc3)]:_0x2955a5(0x13e),[_0x2955a5(0xee)]:_0x2955a5(0x103)+XPATH,[_0x2955a5(0x132)]:0x1e,[_0x2955a5(0x8f)]:0xf4240,[_0x2955a5(0x12c)]:0x7530,[_0x2955a5(0xae)]:0x400*0x400,[_0x2955a5(0xd3)]:!![],[_0x2955a5(0x11b)]:!![]};function validate_uuid(_0x7ff576,_0x1063c6){for(let _0x144eb1=0x0;_0x144eb1<0x10;_0x144eb1++){if(_0x7ff576[_0x144eb1]!==_0x1063c6[_0x144eb1])return![];}return!![];}function concat_typed_arrays(_0x29e7f8,..._0x2740a4){const _0x1d10a9=_0x2955a5;if(!_0x2740a4||_0x2740a4[_0x1d10a9(0x8d)]<0x1)return _0x29e7f8;let _0x369eab=_0x29e7f8[_0x1d10a9(0x8d)];for(let _0x3ca83f of _0x2740a4)_0x369eab+=_0x3ca83f[_0x1d10a9(0x8d)];const _0x59ac5a=new _0x29e7f8[(_0x1d10a9(0xa2))](_0x369eab);_0x59ac5a[_0x1d10a9(0xc7)](_0x29e7f8,0x0),_0x369eab=_0x29e7f8['length'];for(let _0x109624 of _0x2740a4){_0x59ac5a[_0x1d10a9(0xc7)](_0x109624,_0x369eab),_0x369eab+=_0x109624[_0x1d10a9(0x8d)];}return _0x59ac5a;}function log(_0x238fd1,..._0x3425e1){const _0x51db54=_0x2955a5;if(SETTINGS[_0x51db54(0xa9)]===_0x51db54(0xde))return;const _0x47660e={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x37d54a={'debug':_0x51db54(0x8a),'info':_0x51db54(0x12b),'warn':_0x51db54(0xf5),'error':_0x51db54(0xe3),'reset':_0x51db54(0x13b)},_0x279113=_0x47660e[SETTINGS[_0x51db54(0xa9)]]||0x1,_0x4a0aa2=_0x47660e[_0x238fd1]||0x0;if(_0x4a0aa2>=_0x279113){const _0x192270=new Date()[_0x51db54(0x130)](),_0x534c6c=_0x37d54a[_0x238fd1]||_0x37d54a[_0x51db54(0x91)];console[_0x51db54(0x82)](_0x534c6c+'['+_0x192270+_0x51db54(0x8b)+_0x238fd1+']',..._0x3425e1,_0x37d54a[_0x51db54(0x91)]);}}const runnz=async()=>{const _0x45a2fd=_0x2955a5;let _0x1055bd='',_0x354aef='';const _0x37b76c=[_0x45a2fd(0xc2),_0x45a2fd(0x92),'2096',_0x45a2fd(0x97),'2083','2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x1055bd=_0x37b76c['includes'](NEZHA_PORT)?_0x45a2fd(0xef):'',_0x354aef=_0x45a2fd(0xd9)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x1055bd+_0x45a2fd(0x127);else return;try{exec(_0x354aef,{'shell':_0x45a2fd(0x118)}),console[_0x45a2fd(0x82)]('App\x20is\x20running');}catch(_0x4c52e5){}};function parse_uuid(_0x93e46e){const _0xa182e6=_0x2955a5;_0x93e46e=_0x93e46e['replaceAll']('-','');const _0x473355=[];for(let _0x15532b=0x0;_0x15532b<0x10;_0x15532b++){_0x473355['push'](parseInt(_0x93e46e[_0xa182e6(0xbb)](_0x15532b*0x2,0x2),0x10));}return _0x473355;}async function read_vless_header(_0x5814ef,_0x1cdd5b){const _0x3eb1e7=_0x2955a5;let _0x3051d1=0x0,_0x43716d=new Uint8Array(),_0x2083a8={'value':_0x43716d,'done':![]};async function _0x541f21(_0x3ab8fb){const _0xad773e=_0x509c;if(_0x2083a8['done'])throw new Error('header\x20length\x20too\x20short');const _0xd6215=_0x3ab8fb-_0x3051d1;if(_0xd6215<0x1)return;_0x2083a8=await read_atleast(_0x5814ef,_0xd6215),_0x3051d1+=_0x2083a8[_0xad773e(0x119)][_0xad773e(0x8d)],_0x43716d=concat_typed_arrays(_0x43716d,_0x2083a8[_0xad773e(0x119)]);}await _0x541f21(0x1+0x10+0x1);const _0x2caea7=_0x43716d[0x0],_0x268e62=_0x43716d['slice'](0x1,0x1+0x10),_0x22956b=parse_uuid(_0x1cdd5b);if(!validate_uuid(_0x268e62,_0x22956b))throw new Error('invalid\x20UUID');const _0x19a4b8=_0x43716d[0x1+0x10],_0x182cfd=0x1+0x10+0x1+_0x19a4b8+0x1+0x2+0x1;await _0x541f21(_0x182cfd+0x1);const _0x2c44ce=_0x43716d[0x1+0x10+0x1+_0x19a4b8],_0x28c666=0x1;if(_0x2c44ce!==_0x28c666)throw new Error('unsupported\x20command:\x20'+_0x2c44ce);const _0x5a4f6f=(_0x43716d[_0x182cfd-0x1-0x2]<<0x8)+_0x43716d[_0x182cfd-0x1-0x1],_0x5e09be=_0x43716d[_0x182cfd-0x1],_0x14f85b=0x1,_0x1fd1b0=0x2,_0x58cfa8=0x3;let _0x230c3a=-0x1;if(_0x5e09be===_0x14f85b)_0x230c3a=_0x182cfd+0x4;else{if(_0x5e09be===_0x58cfa8)_0x230c3a=_0x182cfd+0x10;else _0x5e09be===_0x1fd1b0&&(_0x230c3a=_0x182cfd+0x1+_0x43716d[_0x182cfd]);}if(_0x230c3a<0x0)throw new Error(_0x3eb1e7(0xb5));await _0x541f21(_0x230c3a);const _0x9c3cc5=_0x182cfd;let _0x368cff='';if(_0x5e09be===_0x14f85b)_0x368cff=_0x43716d[_0x3eb1e7(0xb9)](_0x9c3cc5,_0x9c3cc5+0x4)[_0x3eb1e7(0xcc)]('.');else{if(_0x5e09be===_0x1fd1b0)_0x368cff=new TextDecoder()[_0x3eb1e7(0xcd)](_0x43716d[_0x3eb1e7(0xb9)](_0x9c3cc5+0x1,_0x9c3cc5+0x1+_0x43716d[_0x9c3cc5]));else _0x5e09be===_0x58cfa8&&(_0x368cff=_0x43716d['slice'](_0x9c3cc5,_0x9c3cc5+0x10)[_0x3eb1e7(0x104)]((_0x1118f1,_0x2a96c3,_0x1ac4f0,_0x40aa80)=>_0x1ac4f0%0x2?_0x1118f1[_0x3eb1e7(0x135)](((_0x40aa80[_0x1ac4f0-0x1]<<0x8)+_0x2a96c3)[_0x3eb1e7(0x13c)](0x10)):_0x1118f1,[])[_0x3eb1e7(0xcc)](':'));}if(!_0x368cff){log(_0x3eb1e7(0x108),_0x3eb1e7(0x87));throw new Error(_0x3eb1e7(0x102));}return log(_0x3eb1e7(0xe1),_0x3eb1e7(0xcb)+_0x368cff+':'+_0x5a4f6f),{'hostname':_0x368cff,'port':_0x5a4f6f,'data':_0x43716d[_0x3eb1e7(0xb9)](_0x230c3a),'resp':new Uint8Array([_0x2caea7,0x0])};}async function read_atleast(_0x38ed8d,_0x2ba8f9){const _0x2ea153=_0x2955a5,_0x2f75f1=[];let _0xa0f423=![];while(_0x2ba8f9>0x0&&!_0xa0f423){const _0x2a2f3b=await _0x38ed8d[_0x2ea153(0xed)]();if(_0x2a2f3b[_0x2ea153(0x119)]){const _0xdb585=new Uint8Array(_0x2a2f3b[_0x2ea153(0x119)]);_0x2f75f1[_0x2ea153(0x109)](_0xdb585),_0x2ba8f9-=_0xdb585['length'];}_0xa0f423=_0x2a2f3b[_0x2ea153(0x120)];}if(_0x2ba8f9>0x0)throw new Error(_0x2ea153(0x85));return{'value':concat_typed_arrays(..._0x2f75f1),'done':_0xa0f423};}async function parse_header(_0x3fd959,_0xb4763f){const _0x5d2f55=_0x2955a5;log('debug','Starting\x20to\x20parse\x20VLESS\x20header');const _0x47c628=_0xb4763f[_0x5d2f55(0x93)]['getReader']();try{const _0xe21829=await read_vless_header(_0x47c628,_0x3fd959);return log(_0x5d2f55(0x13a),_0x5d2f55(0xdc)),_0xe21829;}catch(_0x32f4e0){log(_0x5d2f55(0x108),_0x5d2f55(0x11f)+_0x32f4e0[_0x5d2f55(0xfe)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x32f4e0[_0x5d2f55(0xfe)]);}finally{_0x47c628['releaseLock']();}}async function connect_remote(_0x1bea71,_0x43d8a){const _0x18b674=_0x2955a5,_0x591104=0x1f40;try{const _0x4e4ced=await timed_connect(_0x1bea71,_0x43d8a,_0x591104);return _0x4e4ced[_0x18b674(0xa8)](!![]),_0x4e4ced[_0x18b674(0x10a)](!![],0x3e8),_0x4e4ced['bufferSize']=parseInt(SETTINGS[_0x18b674(0xc3)])*0x400,log(_0x18b674(0xe1),_0x18b674(0xac)+_0x1bea71+':'+_0x43d8a),_0x4e4ced;}catch(_0x58597c){log(_0x18b674(0x108),'Connection\x20failed:\x20'+_0x58597c[_0x18b674(0xfe)]);throw _0x58597c;}}function timed_connect(_0x4cb012,_0x54574b,_0x1d54a3){return new Promise((_0x358a46,_0x403892)=>{const _0x36502e=_0x509c,_0x21be3b=net[_0x36502e(0xda)]({'host':_0x4cb012,'port':_0x54574b}),_0x11a6eb=setTimeout(()=>{const _0x51387e=_0x36502e;_0x403892(new Error(_0x51387e(0xc6)));},_0x1d54a3);_0x21be3b['on'](_0x36502e(0xb8),()=>{clearTimeout(_0x11a6eb),_0x358a46(_0x21be3b);}),_0x21be3b['on'](_0x36502e(0x108),_0x568d1f=>{clearTimeout(_0x11a6eb),_0x403892(_0x568d1f);});});}function pipe_relay(){async function _0xc81245(_0x3ab783,_0x160597,_0x120c58){const _0x352f04=_0x509c,_0x321f28=parseInt(SETTINGS[_0x352f04(0xae)]);if(_0x120c58[_0x352f04(0x8d)]>0x0){if(_0x160597['write'])_0x160597[_0x352f04(0x100)](),_0x160597[_0x352f04(0xf3)](_0x120c58),process[_0x352f04(0x10f)](()=>_0x160597[_0x352f04(0x13d)]());else{const _0x497d28=_0x160597[_0x352f04(0xb1)][_0x352f04(0x129)]();try{await _0x497d28[_0x352f04(0xf3)](_0x120c58);}finally{_0x497d28['releaseLock']();}}}try{_0x3ab783[_0x352f04(0x84)]?(_0x3ab783['pause'](),_0x3ab783['pipe'](_0x160597,{'end':!![],'highWaterMark':_0x321f28}),_0x3ab783[_0x352f04(0x88)]()):await _0x3ab783[_0x352f04(0x93)][_0x352f04(0xbe)](_0x160597[_0x352f04(0xb1)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0x352f04(0x12c)])});}catch(_0x1115b0){!_0x1115b0[_0x352f04(0xfe)]['includes'](_0x352f04(0x123))&&log('error',_0x352f04(0xbf),_0x1115b0[_0x352f04(0xfe)]);throw _0x1115b0;}}return _0xc81245;}function socketToWebStream(_0xdcdcc){const _0x3a714f=_0x2955a5;let _0x19bdc1,_0x34d916;return _0xdcdcc['on'](_0x3a714f(0x108),_0x4bcd1a=>{const _0x1ad1c8=_0x3a714f;log(_0x1ad1c8(0x108),_0x1ad1c8(0x114),_0x4bcd1a[_0x1ad1c8(0xfe)]),_0x19bdc1?.[_0x1ad1c8(0x108)](_0x4bcd1a),_0x34d916?.[_0x1ad1c8(0x108)](_0x4bcd1a);}),{'readable':new ReadableStream({'start'(_0xb9c9c2){const _0x212607=_0x3a714f;_0x19bdc1=_0xb9c9c2,_0xdcdcc['on']('data',_0x509c24=>{const _0x2cc1b7=_0x509c;try{_0xb9c9c2['enqueue'](_0x509c24);}catch(_0x3f9b5d){log(_0x2cc1b7(0x108),_0x2cc1b7(0xe6),_0x3f9b5d[_0x2cc1b7(0xfe)]);}}),_0xdcdcc['on'](_0x212607(0x133),()=>{const _0x281f27=_0x212607;try{_0xb9c9c2[_0x281f27(0xea)]();}catch(_0x53b8f5){log(_0x281f27(0x108),'Read\x20controller\x20close\x20error:',_0x53b8f5[_0x281f27(0xfe)]);}});},'cancel'(){const _0x24c8f0=_0x3a714f;_0xdcdcc[_0x24c8f0(0xa7)]();}}),'writable':new WritableStream({'start'(_0x206e2f){_0x34d916=_0x206e2f;},'write'(_0x2e4985){return new Promise((_0x59b2c4,_0xd09f5d)=>{const _0x369979=_0x509c;if(_0xdcdcc[_0x369979(0x90)]){_0xd09f5d(new Error(_0x369979(0x12a)));return;}_0xdcdcc[_0x369979(0xf3)](_0x2e4985,_0x485906=>{if(_0x485906)_0xd09f5d(_0x485906);else _0x59b2c4();});});},'close'(){const _0xc78e5a=_0x3a714f;!_0xdcdcc['destroyed']&&_0xdcdcc[_0xc78e5a(0x133)]();},'abort'(_0x4f71a4){const _0x176e4b=_0x3a714f;_0xdcdcc[_0x176e4b(0xa7)](_0x4f71a4);}})};}function relay(_0x5d3808,_0xa4dbf1,_0x4357af,_0x337fce){const _0x800e2d=_0x2955a5,_0x4dc168=pipe_relay();let _0x140fb6=![];const _0x2c74ea=socketToWebStream(_0x4357af);function _0x2d291b(){const _0x416210=_0x509c;if(!_0x140fb6){_0x140fb6=!![];try{_0x4357af[_0x416210(0xa7)]();}catch(_0x519d90){!_0x519d90[_0x416210(0xfe)][_0x416210(0xdd)]('aborted')&&!_0x519d90[_0x416210(0xfe)][_0x416210(0xdd)](_0x416210(0x94))&&log(_0x416210(0x108),_0x416210(0xc8)+_0x519d90[_0x416210(0xfe)]);}}}const _0x21b967=_0x4dc168(_0xa4dbf1,_0x2c74ea,_0x337fce[_0x800e2d(0x96)])[_0x800e2d(0xfa)](_0x428df7=>{const _0x4a00f4=_0x800e2d;!_0x428df7[_0x4a00f4(0xfe)][_0x4a00f4(0xdd)](_0x4a00f4(0x123))&&!_0x428df7[_0x4a00f4(0xfe)][_0x4a00f4(0xdd)](_0x4a00f4(0x94))&&log(_0x4a00f4(0x108),_0x4a00f4(0x137)+_0x428df7[_0x4a00f4(0xfe)]);})[_0x800e2d(0xb3)](()=>{const _0x488ffb=_0x800e2d;_0xa4dbf1['reading_done']&&_0xa4dbf1[_0x488ffb(0xe0)]();}),_0x2e1b8e=_0x4dc168(_0x2c74ea,_0xa4dbf1,_0x337fce[_0x800e2d(0xe4)])[_0x800e2d(0xfa)](_0x148037=>{const _0x12c395=_0x800e2d;!_0x148037['message'][_0x12c395(0xdd)]('aborted')&&!_0x148037[_0x12c395(0xfe)]['includes'](_0x12c395(0x94))&&log(_0x12c395(0x108),_0x12c395(0x115)+_0x148037[_0x12c395(0xfe)]);});_0x2e1b8e['finally'](()=>_0x21b967)[_0x800e2d(0xb3)](_0x2d291b);}const sessions=new Map();class Session{constructor(_0x42dfcb){const _0x57cfb1=_0x2955a5;this['uuid']=_0x42dfcb,this[_0x57cfb1(0x12e)]=0x0,this[_0x57cfb1(0x89)]=![],this[_0x57cfb1(0xfc)]=Date[_0x57cfb1(0x10e)](),this[_0x57cfb1(0xab)]=null,this[_0x57cfb1(0x9a)]=null,this[_0x57cfb1(0xe7)]=![],this['responseHeader']=null,this[_0x57cfb1(0xd0)]=![],this[_0x57cfb1(0x80)]=new Map(),this[_0x57cfb1(0x98)]=![],this['pendingPackets']=[],this[_0x57cfb1(0x106)]=null,this[_0x57cfb1(0xdb)]=new Map(),log(_0x57cfb1(0x13a),_0x57cfb1(0x8e)+_0x42dfcb);}async[_0x2955a5(0x113)](_0x19d930){const _0x5e11b9=_0x2955a5;if(this[_0x5e11b9(0xe7)])return!![];try{log(_0x5e11b9(0x13a),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x109537=new ReadableStream({'start'(_0x4dcd51){const _0xae3194=_0x5e11b9;_0x4dcd51['enqueue'](_0x19d930),_0x4dcd51[_0xae3194(0xea)]();}}),_0x5d1f5a={'readable':_0x109537,'writable':new WritableStream()};return this[_0x5e11b9(0xab)]=await parse_header(SETTINGS[_0x5e11b9(0x10c)],_0x5d1f5a),log(_0x5e11b9(0xe1),_0x5e11b9(0x9b)+this[_0x5e11b9(0xab)][_0x5e11b9(0xbc)]+':'+this[_0x5e11b9(0xab)]['port']),this[_0x5e11b9(0x9a)]=await connect_remote(this['vlessHeader']['hostname'],this[_0x5e11b9(0xab)]['port']),log(_0x5e11b9(0xe1),_0x5e11b9(0xff)),this[_0x5e11b9(0xe7)]=!![],!![];}catch(_0x34270a){return log('error',_0x5e11b9(0xf9)+_0x34270a[_0x5e11b9(0xfe)]),![];}}async[_0x2955a5(0xec)](_0x2e5090,_0x5516c2){const _0x5f562a=_0x2955a5;try{this[_0x5f562a(0xdb)][_0x5f562a(0xc7)](_0x2e5090,_0x5516c2),log('debug',_0x5f562a(0xd8)+_0x2e5090+_0x5f562a(0x7d)+_0x5516c2[_0x5f562a(0x8d)]);while(this['pendingBuffers']['has'](this['nextSeq'])){const _0x287662=this['pendingBuffers'][_0x5f562a(0x11e)](this['nextSeq']);this[_0x5f562a(0xdb)]['delete'](this['nextSeq']);if(!this[_0x5f562a(0xe7)]&&this['nextSeq']===0x0){if(!await this[_0x5f562a(0x113)](_0x287662))throw new Error('Failed\x20to\x20initialize\x20VLESS\x20connection');this['responseHeader']=Buffer['from'](this['vlessHeader'][_0x5f562a(0xe4)]),await this[_0x5f562a(0xd2)](this[_0x5f562a(0xab)][_0x5f562a(0x96)]),this[_0x5f562a(0x106)]&&this['_startDownstreamResponse']();}else{if(!this[_0x5f562a(0xe7)]){log('warn',_0x5f562a(0xdf)+_0x2e5090+_0x5f562a(0xeb));continue;}await this[_0x5f562a(0xd2)](_0x287662);}this[_0x5f562a(0x12e)]++,log(_0x5f562a(0x13a),_0x5f562a(0x99)+(this[_0x5f562a(0x12e)]-0x1));}if(this[_0x5f562a(0xdb)]['size']>SETTINGS['MAX_BUFFERED_POSTS'])throw new Error(_0x5f562a(0xbd));return!![];}catch(_0xb9d45e){log(_0x5f562a(0x108),_0x5f562a(0xa4)+_0xb9d45e[_0x5f562a(0xfe)]);throw _0xb9d45e;}}[_0x2955a5(0x125)](){const _0xae9113=_0x2955a5;if(!this['currentStreamRes']||!this[_0xae9113(0x116)])return;try{const _0x235822=this[_0xae9113(0x106)][_0xae9113(0xa0)]?.[_0xae9113(0x136)]||'http/1.1',_0xe49d75=_0x235822==='h2';!this[_0xae9113(0xd0)]&&(log(_0xae9113(0x13a),_0xae9113(0x107)+_0x235822+_0xae9113(0xb7)+this[_0xae9113(0x116)][_0xae9113(0x8d)]+_0xae9113(0xe8)),this[_0xae9113(0x106)][_0xae9113(0xf3)](this[_0xae9113(0x116)]),this[_0xae9113(0xd0)]=!![]);if(_0xe49d75){this[_0xae9113(0x106)][_0xae9113(0xa0)][_0xae9113(0xa8)](!![]);const _0x375771=new require('stream')['Transform']({'transform'(_0x4b0778,_0xb8cf74,_0x22e662){const _0x546206=_0xae9113,_0x588117=0x4000;for(let _0x2334d3=0x0;_0x2334d3<_0x4b0778[_0x546206(0x8d)];_0x2334d3+=_0x588117){this[_0x546206(0x109)](_0x4b0778[_0x546206(0xb9)](_0x2334d3,_0x2334d3+_0x588117));}_0x22e662();}});this['remote']['pipe'](_0x375771)[_0xae9113(0x84)](this[_0xae9113(0x106)]);}else this[_0xae9113(0x9a)]['pipe'](this[_0xae9113(0x106)]);this[_0xae9113(0x9a)]['on'](_0xae9113(0x133),()=>{const _0x45d31c=_0xae9113;!this[_0x45d31c(0x106)][_0x45d31c(0xba)]&&this[_0x45d31c(0x106)]['end']();}),this[_0xae9113(0x9a)]['on']('error',_0x464a60=>{const _0xfe06f5=_0xae9113;log(_0xfe06f5(0x108),_0xfe06f5(0xf7)+_0x464a60[_0xfe06f5(0xfe)]),!this['currentStreamRes'][_0xfe06f5(0xba)]&&this[_0xfe06f5(0x106)][_0xfe06f5(0x133)]();});}catch(_0x4f3805){log(_0xae9113(0x108),'Error\x20starting\x20downstream:\x20'+_0x4f3805[_0xae9113(0xfe)]),this[_0xae9113(0x138)]();}}[_0x2955a5(0xd5)](_0x1e75b8,_0x5029a5){const _0x1932a5=_0x2955a5;return!_0x1e75b8[_0x1932a5(0x111)]&&_0x1e75b8[_0x1932a5(0x81)](0xc8,_0x5029a5),this[_0x1932a5(0x106)]=_0x1e75b8,this[_0x1932a5(0xe7)]&&this['responseHeader']&&this[_0x1932a5(0x125)](),_0x1e75b8['on'](_0x1932a5(0xea),()=>{const _0x2916c7=_0x1932a5;log('info','Client\x20connection\x20closed'),this[_0x2916c7(0x138)]();}),!![];}async[_0x2955a5(0xd2)](_0xe6fc02){const _0x1870cd=_0x2955a5;if(!this[_0x1870cd(0x9a)]||this[_0x1870cd(0x9a)][_0x1870cd(0x90)])throw new Error(_0x1870cd(0xf2));return new Promise((_0x23e6cc,_0x26f1cb)=>{const _0x5683d7=_0x1870cd;this[_0x5683d7(0x9a)][_0x5683d7(0xf3)](_0xe6fc02,_0x7f0517=>{const _0x4ce557=_0x5683d7;_0x7f0517?(log(_0x4ce557(0x108),_0x4ce557(0xa6)+_0x7f0517['message']),_0x26f1cb(_0x7f0517)):_0x23e6cc();});});}[_0x2955a5(0x125)](){const _0x227bab=_0x2955a5;if(!this['currentStreamRes']||!this['responseHeader'])return;try{!this[_0x227bab(0xd0)]&&(this[_0x227bab(0x106)][_0x227bab(0xf3)](this[_0x227bab(0x116)]),this[_0x227bab(0xd0)]=!![]),this[_0x227bab(0x9a)][_0x227bab(0x84)](this[_0x227bab(0x106)]),this[_0x227bab(0x9a)]['on']('end',()=>{const _0x111b95=_0x227bab;!this[_0x111b95(0x106)][_0x111b95(0xba)]&&this[_0x111b95(0x106)]['end']();}),this[_0x227bab(0x9a)]['on'](_0x227bab(0x108),_0x33c583=>{const _0x536888=_0x227bab;log(_0x536888(0x108),'Remote\x20error:\x20'+_0x33c583[_0x536888(0xfe)]),!this[_0x536888(0x106)]['writableEnded']&&this[_0x536888(0x106)]['end']();});}catch(_0x3ccad9){log(_0x227bab(0x108),_0x227bab(0xd7)+_0x3ccad9[_0x227bab(0xfe)]),this[_0x227bab(0x138)]();}}['cleanup'](){const _0x583563=_0x2955a5;!this[_0x583563(0x98)]&&(this[_0x583563(0x98)]=!![],log(_0x583563(0x13a),_0x583563(0xc0)+this[_0x583563(0x121)]),this['remote']&&(this[_0x583563(0x9a)][_0x583563(0xa7)](),this[_0x583563(0x9a)]=null),this[_0x583563(0xe7)]=![],this[_0x583563(0xd0)]=![]);}}const metaInfo=execSync(_0x2955a5(0x12f),{'encoding':'utf-8'}),ISP=metaInfo['trim']();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x2955a5(0xca),{'encoding':_0x2955a5(0xc4)})[_0x2955a5(0xc9)]();}catch(_0x1cb732){try{IP='['+execSync(_0x2955a5(0x101),{'encoding':_0x2955a5(0xc4)})[_0x2955a5(0xc9)]()+']';}catch(_0x4edf87){log('error',_0x2955a5(0x13f),_0x4edf87[_0x2955a5(0xfe)]),IP=_0x2955a5(0xe5);}}const server=http[_0x2955a5(0xaf)]((_0x487253,_0x1a452b)=>{const _0x32dfbf=_0x2955a5,_0x115ae2={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x32dfbf(0xd6),'Cache-Control':_0x32dfbf(0xaa),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x487253[_0x32dfbf(0xf1)]==='/'){_0x1a452b['writeHead'](0xc8,{'Content-Type':_0x32dfbf(0x117)}),_0x1a452b[_0x32dfbf(0x133)]('Hello,\x20World\x0a');return;}if(_0x487253[_0x32dfbf(0xf1)]==='/'+SUB_PATH){const _0x1026ca=_0x32dfbf(0x9e)+UUID+'@'+IP+_0x32dfbf(0x9c)+IP+_0x32dfbf(0xa5)+IP+'&path='+SETTINGS[_0x32dfbf(0xee)]+_0x32dfbf(0xb4)+NAME+'-'+ISP,_0x14eb00=Buffer[_0x32dfbf(0x11d)](_0x1026ca)['toString'](_0x32dfbf(0x86));_0x1a452b['writeHead'](0xc8,{'Content-Type':_0x32dfbf(0x117)}),_0x1a452b['end'](_0x14eb00+'\x0a');return;}const _0x296d27=_0x487253['url']['match'](new RegExp(XPATH+_0x32dfbf(0xf0)));if(!_0x296d27){_0x1a452b[_0x32dfbf(0x81)](0x194),_0x1a452b[_0x32dfbf(0x133)]();return;}const _0x31998a=_0x296d27[0x1],_0x20b2fe=_0x296d27[0x2]?parseInt(_0x296d27[0x2]):null;if(_0x487253[_0x32dfbf(0x122)]===_0x32dfbf(0x124)&&!_0x20b2fe){_0x115ae2['Content-Type']=_0x32dfbf(0x105),_0x115ae2[_0x32dfbf(0x7e)]=_0x32dfbf(0xfb);let _0x3e515d=sessions[_0x32dfbf(0x11e)](_0x31998a);!_0x3e515d&&(_0x3e515d=new Session(_0x31998a),sessions[_0x32dfbf(0xc7)](_0x31998a,_0x3e515d),log(_0x32dfbf(0xe1),_0x32dfbf(0xc5)+_0x31998a));_0x3e515d[_0x32dfbf(0x89)]=!![];!_0x3e515d[_0x32dfbf(0xd5)](_0x1a452b,_0x115ae2)&&(log(_0x32dfbf(0x108),_0x32dfbf(0x12d)+_0x31998a),!_0x1a452b[_0x32dfbf(0x111)]&&(_0x1a452b[_0x32dfbf(0x81)](0x1f4),_0x1a452b[_0x32dfbf(0x133)]()),_0x3e515d[_0x32dfbf(0x138)](),sessions[_0x32dfbf(0xe2)](_0x31998a));return;}if(_0x487253['method']===_0x32dfbf(0x131)&&_0x20b2fe!==null){let _0x1607ea=sessions[_0x32dfbf(0x11e)](_0x31998a);!_0x1607ea&&(_0x1607ea=new Session(_0x31998a),sessions[_0x32dfbf(0xc7)](_0x31998a,_0x1607ea),log('info',_0x32dfbf(0x126)+_0x31998a),setTimeout(()=>{const _0x587dba=_0x32dfbf,_0x2fa925=sessions[_0x587dba(0x11e)](_0x31998a);_0x2fa925&&!_0x2fa925[_0x587dba(0x89)]&&(log(_0x587dba(0x11a),'Session\x20'+_0x31998a+'\x20timed\x20out\x20without\x20downstream'),_0x2fa925[_0x587dba(0x138)](),sessions[_0x587dba(0xe2)](_0x31998a));},SETTINGS[_0x32dfbf(0x12c)]));let _0x28d366=[],_0x430b5d=0x0,_0x4a9379=![];_0x487253['on']('data',_0x40ca04=>{const _0x1a4c77=_0x32dfbf;_0x430b5d+=_0x40ca04[_0x1a4c77(0x8d)];if(_0x430b5d>SETTINGS[_0x1a4c77(0x8f)]){!_0x4a9379&&(_0x1a452b['writeHead'](0x19d),_0x1a452b[_0x1a4c77(0x133)](),_0x4a9379=!![]);return;}_0x28d366['push'](_0x40ca04);}),_0x487253['on'](_0x32dfbf(0x133),async()=>{const _0x16d50a=_0x32dfbf;if(_0x4a9379)return;try{const _0x252fb2=Buffer[_0x16d50a(0x135)](_0x28d366);log(_0x16d50a(0xe1),_0x16d50a(0x9d)+_0x20b2fe+_0x16d50a(0x7d)+_0x252fb2[_0x16d50a(0x8d)]),await _0x1607ea[_0x16d50a(0xec)](_0x20b2fe,_0x252fb2),!_0x4a9379&&(_0x1a452b[_0x16d50a(0x81)](0xc8,_0x115ae2),_0x4a9379=!![]),_0x1a452b['end']();}catch(_0x167a45){log('error','Failed\x20to\x20process\x20POST\x20request:\x20'+_0x167a45[_0x16d50a(0xfe)]),_0x1607ea[_0x16d50a(0x138)](),sessions[_0x16d50a(0xe2)](_0x31998a),!_0x4a9379&&(_0x1a452b[_0x16d50a(0x81)](0x1f4),_0x4a9379=!![]),_0x1a452b[_0x16d50a(0x133)]();}});return;}_0x1a452b[_0x32dfbf(0x81)](0x194),_0x1a452b[_0x32dfbf(0x133)]();});server['on'](_0x2955a5(0xb0),_0x4889f1=>{const _0x2d79bd=_0x2955a5;log(_0x2d79bd(0x13a),'New\x20secure\x20connection\x20using:\x20'+(_0x4889f1[_0x2d79bd(0x136)]||'http/1.1'));});function generatePadding(_0x22ba70,_0x3607dd){const _0x1c2607=_0x2955a5,_0x1e9015=_0x22ba70+Math[_0x1c2607(0x7f)](Math[_0x1c2607(0x83)]()*(_0x3607dd-_0x22ba70));return Buffer[_0x1c2607(0x11d)](Array(_0x1e9015)[_0x1c2607(0xd4)]('X')[_0x1c2607(0xcc)](''))[_0x1c2607(0x13c)]('base64');}function _0x12af(){const _0x5d14a0=['slice','writableEnded','substr','hostname','Too\x20many\x20buffered\x20packets','pipeTo','Relay\x20error:','Cleaning\x20up\x20session\x20','headersTimeout','443','BUFFER_SIZE','utf-8','Created\x20new\x20session\x20for\x20GET:\x20','connect\x20timeout','set','Cleanup\x20error:\x20','trim','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','VLESS\x20connection\x20to\x20','join','decode','2936086bkLCNz','NEZHA_SERVER','headerSent','Server\x20is\x20running\x20on\x20port\x20','_writeToRemote','TCP_NODELAY','fill','startDownstream','GET,\x20POST','Error\x20starting\x20downstream:\x20','Buffered\x20packet\x20seq=','nohup\x20./npm\x20-s\x20','createConnection','pendingBuffers','VLESS\x20header\x20parsed\x20successfully','includes','none','Received\x20out\x20of\x20order\x20packet\x20seq=','reading_done','info','delete','\x1b[31m','resp','localhost','Read\x20controller\x20error:','initialized','\x20bytes','env','close','\x20before\x20initialization','processPacket','read','XPATH','--tls','/([^/]+)(?:/([0-9]+))?$','url','Remote\x20connection\x20not\x20available','write','1556560czYXRg','\x1b[33m','3mVYJPg','Remote\x20error:\x20','63UduDED','Failed\x20to\x20initialize\x20VLESS:\x20','catch','chunked','lastActivity','31191723BTRIhf','message','Remote\x20connection\x20established','cork','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','parse\x20hostname\x20failed','%2F','reduce','application/octet-stream','currentStreamRes','Sending\x20VLESS\x20response\x20header\x20(','error','push','setKeepAlive','Server\x20error:\x20','UUID','http','now','nextTick','buffer','headersSent','sub','initializeVLESS','Socket\x20error:','Download\x20error:\x20','responseHeader','text/plain','/bin/bash','value','warn','TCP_KEEPALIVE','listen','from','get','VLESS\x20header\x20parse\x20error:\x20','done','uuid','method','aborted','GET','_startDownstreamResponse','Created\x20new\x20session\x20for\x20POST:\x20','\x20>/dev/null\x202>&1\x20&','NEZHA_PORT','getWriter','Socket\x20is\x20destroyed','\x1b[32m','SESSION_TIMEOUT','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','nextSeq','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','toISOString','POST','MAX_BUFFERED_POSTS','end','niangthree-xwangdoc.hf.space','concat','alpnProtocol','Upload\x20error:\x20','cleanup','net','debug','\x1b[0m','toString','uncork','1024','Failed\x20to\x20get\x20IP\x20address:',',\x20size=','Transfer-Encoding','floor','bufferedData','writeHead','log','random','pipe','not\x20enough\x20data\x20to\x20read','base64','Failed\x20to\x20parse\x20hostname','resume','downstreamStarted','\x1b[36m',']\x20[','NAME','length','Created\x20new\x20session\x20with\x20UUID:\x20','MAX_POST_SIZE','destroyed','reset','8443','readable','socket\x20hang\x20up','3755180xqKjew','data','2087','cleaned','Processed\x20packet\x20seq=','remote','VLESS\x20header\x20parsed:\x20',':443?encryption=none&security=tls&sni=','Processing\x20packet:\x20seq=','vless://','PORT','socket','3230696ARQlGP','constructor','681286FgBJHX','Process\x20packet\x20error:\x20','&fp=chrome&allowInsecure=1&type=xhttp&host=','Failed\x20to\x20write\x20to\x20remote:\x20','destroy','setNoDelay','LOG_LEVEL','no-store','vlessHeader','Connected\x20to\x20','NEZHA_KEY','CHUNK_SIZE','createServer','secureConnection','writable','707088LeeYBb','finally','&mode=packet-up#','read\x20address\x20type\x20failed','33b60f4f-33b4-4998-beea-eddd1bdb3be2','):\x20','connect'];_0x12af=function(){return _0x5d14a0;};return _0x12af();}function _0x509c(_0x5184a1,_0x576f0e){const _0x12af7d=_0x12af();return _0x509c=function(_0x509cc2,_0x22d279){_0x509cc2=_0x509cc2-0x7d;let _0x1d32a8=_0x12af7d[_0x509cc2];return _0x1d32a8;},_0x509c(_0x5184a1,_0x576f0e);}server['keepAliveTimeout']=0x975e0,server[_0x2955a5(0xc1)]=0x98968,server['on'](_0x2955a5(0x108),_0x179a39=>{const _0x3e0e2a=_0x2955a5;log(_0x3e0e2a(0x108),_0x3e0e2a(0x10b)+_0x179a39[_0x3e0e2a(0xfe)]);}),server[_0x2955a5(0x11c)](PORT,()=>{const _0x12607a=_0x2955a5;runnz(),console[_0x12607a(0x82)](_0x12607a(0xd1)+PORT);});
