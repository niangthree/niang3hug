const _0x187c77=_0x1663;(function(_0xb130cd,_0x383629){const _0xa236cc=_0x1663,_0x4f2518=_0xb130cd();while(!![]){try{const _0x473a5f=-parseInt(_0xa236cc(0x14a))/0x1*(-parseInt(_0xa236cc(0x168))/0x2)+parseInt(_0xa236cc(0x1c3))/0x3+-parseInt(_0xa236cc(0x1ba))/0x4*(-parseInt(_0xa236cc(0x123))/0x5)+parseInt(_0xa236cc(0x121))/0x6+parseInt(_0xa236cc(0x141))/0x7+parseInt(_0xa236cc(0x1d2))/0x8*(parseInt(_0xa236cc(0x1a8))/0x9)+-parseInt(_0xa236cc(0x126))/0xa*(parseInt(_0xa236cc(0x11f))/0xb);if(_0x473a5f===_0x383629)break;else _0x4f2518['push'](_0x4f2518['shift']());}catch(_0x46a1ad){_0x4f2518['push'](_0x4f2518['shift']());}}}(_0x36fb,0x3eb7e));const net=require(_0x187c77(0x17f)),http=require(_0x187c77(0x1d8)),{Buffer}=require(_0x187c77(0x135)),{exec,execSync}=require(_0x187c77(0x170)),UUID=process[_0x187c77(0x165)][_0x187c77(0x156)]||_0x187c77(0x14c),NEZHA_SERVER=process[_0x187c77(0x165)][_0x187c77(0x1a1)]||'',NEZHA_PORT=process[_0x187c77(0x165)][_0x187c77(0x1a2)]||'',NEZHA_KEY=process['env'][_0x187c77(0x1b0)]||'',SUB_PATH=process[_0x187c77(0x165)][_0x187c77(0x1c1)]||_0x187c77(0x15e),XPATH=process['env'][_0x187c77(0x1bd)]||UUID['slice'](0x0,0x8),DOMAIN=process[_0x187c77(0x165)]['DOMAIN']||'niangthree-xwang-doc.hf.space',NAME=process[_0x187c77(0x165)][_0x187c77(0x172)]||'Hf',PORT=process['env'][_0x187c77(0x152)]||0x1eb4,SETTINGS={[_0x187c77(0x156)]:UUID,[_0x187c77(0x1b5)]:'none',['BUFFER_SIZE']:'1024',[_0x187c77(0x1bd)]:'%2F'+XPATH,['MAX_BUFFERED_POSTS']:0x1e,[_0x187c77(0x1a3)]:0xf4240,[_0x187c77(0x14d)]:0x7530,[_0x187c77(0x164)]:0x400*0x400,[_0x187c77(0x120)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0xc7f370,_0x22604b){for(let _0x12a5a6=0x0;_0x12a5a6<0x10;_0x12a5a6++){if(_0xc7f370[_0x12a5a6]!==_0x22604b[_0x12a5a6])return![];}return!![];}function concat_typed_arrays(_0x5d9c77,..._0x3d55f1){const _0x561777=_0x187c77;if(!_0x3d55f1||_0x3d55f1['length']<0x1)return _0x5d9c77;let _0x296066=_0x5d9c77['length'];for(let _0x2a5274 of _0x3d55f1)_0x296066+=_0x2a5274[_0x561777(0x1b1)];const _0x4e4e7d=new _0x5d9c77[(_0x561777(0x186))](_0x296066);_0x4e4e7d['set'](_0x5d9c77,0x0),_0x296066=_0x5d9c77['length'];for(let _0x254468 of _0x3d55f1){_0x4e4e7d[_0x561777(0x171)](_0x254468,_0x296066),_0x296066+=_0x254468[_0x561777(0x1b1)];}return _0x4e4e7d;}function log(_0x905141,..._0x5c734c){const _0xd90506=_0x187c77;if(SETTINGS['LOG_LEVEL']===_0xd90506(0x139))return;const _0x303b8c={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x2a7a46={'debug':'\x1b[36m','info':_0xd90506(0x1b8),'warn':'\x1b[33m','error':'\x1b[31m','reset':'\x1b[0m'},_0x266f37=_0x303b8c[SETTINGS[_0xd90506(0x1b5)]]||0x1,_0x107d95=_0x303b8c[_0x905141]||0x0;if(_0x107d95>=_0x266f37){const _0x89060c=new Date()[_0xd90506(0x15d)](),_0x42af4f=_0x2a7a46[_0x905141]||_0x2a7a46[_0xd90506(0x14b)];console[_0xd90506(0x151)](_0x42af4f+'['+_0x89060c+_0xd90506(0x12b)+_0x905141+']',..._0x5c734c,_0x2a7a46[_0xd90506(0x14b)]);}}const runnz=async()=>{const _0x13036d=_0x187c77;let _0x146464='',_0xedeb23='';const _0x3dc0d0=['443',_0x13036d(0x199),_0x13036d(0x1b9),_0x13036d(0x16f),_0x13036d(0x143),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY)_0x146464=_0x3dc0d0[_0x13036d(0x144)](NEZHA_PORT)?_0x13036d(0x158):'',_0xedeb23=_0x13036d(0x12c)+NEZHA_SERVER+':'+NEZHA_PORT+_0x13036d(0x145)+NEZHA_KEY+'\x20'+_0x146464+_0x13036d(0x12a);else return;try{exec(_0xedeb23,{'shell':_0x13036d(0x1ad)}),console['log'](_0x13036d(0x1a0));}catch(_0x1bc04a){}};function parse_uuid(_0x309f94){const _0x1e3c65=_0x187c77;_0x309f94=_0x309f94[_0x1e3c65(0x183)]('-','');const _0x3765c1=[];for(let _0x208b01=0x0;_0x208b01<0x10;_0x208b01++){_0x3765c1[_0x1e3c65(0x167)](parseInt(_0x309f94[_0x1e3c65(0x12e)](_0x208b01*0x2,0x2),0x10));}return _0x3765c1;}async function read_vless_header(_0x9ad1ad,_0x5bb2b8){const _0xdfdd5c=_0x187c77;let _0x56530a=0x0,_0x345338=new Uint8Array(),_0x3ddfcd={'value':_0x345338,'done':![]};async function _0x3f0e92(_0x3aeeeb){const _0x5ceb64=_0x1663;if(_0x3ddfcd[_0x5ceb64(0x163)])throw new Error(_0x5ceb64(0x1cf));const _0x3bfec9=_0x3aeeeb-_0x56530a;if(_0x3bfec9<0x1)return;_0x3ddfcd=await read_atleast(_0x9ad1ad,_0x3bfec9),_0x56530a+=_0x3ddfcd[_0x5ceb64(0x1be)][_0x5ceb64(0x1b1)],_0x345338=concat_typed_arrays(_0x345338,_0x3ddfcd[_0x5ceb64(0x1be)]);}await _0x3f0e92(0x1+0x10+0x1);const _0x5e7cf8=_0x345338[0x0],_0xf7326=_0x345338[_0xdfdd5c(0x15f)](0x1,0x1+0x10),_0x1872f1=parse_uuid(_0x5bb2b8);if(!validate_uuid(_0xf7326,_0x1872f1))throw new Error(_0xdfdd5c(0x184));const _0xb41040=_0x345338[0x1+0x10],_0x4072cd=0x1+0x10+0x1+_0xb41040+0x1+0x2+0x1;await _0x3f0e92(_0x4072cd+0x1);const _0x1d1a8e=_0x345338[0x1+0x10+0x1+_0xb41040],_0x442bfd=0x1;if(_0x1d1a8e!==_0x442bfd)throw new Error(_0xdfdd5c(0x138)+_0x1d1a8e);const _0x58ff60=(_0x345338[_0x4072cd-0x1-0x2]<<0x8)+_0x345338[_0x4072cd-0x1-0x1],_0xe2b43c=_0x345338[_0x4072cd-0x1],_0x1310ba=0x1,_0x49e464=0x2,_0x4d4939=0x3;let _0x434c30=-0x1;if(_0xe2b43c===_0x1310ba)_0x434c30=_0x4072cd+0x4;else{if(_0xe2b43c===_0x4d4939)_0x434c30=_0x4072cd+0x10;else _0xe2b43c===_0x49e464&&(_0x434c30=_0x4072cd+0x1+_0x345338[_0x4072cd]);}if(_0x434c30<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x3f0e92(_0x434c30);const _0x1a29c0=_0x4072cd;let _0x5ad8de='';if(_0xe2b43c===_0x1310ba)_0x5ad8de=_0x345338[_0xdfdd5c(0x15f)](_0x1a29c0,_0x1a29c0+0x4)['join']('.');else{if(_0xe2b43c===_0x49e464)_0x5ad8de=new TextDecoder()[_0xdfdd5c(0x1b3)](_0x345338['slice'](_0x1a29c0+0x1,_0x1a29c0+0x1+_0x345338[_0x1a29c0]));else _0xe2b43c===_0x4d4939&&(_0x5ad8de=_0x345338[_0xdfdd5c(0x15f)](_0x1a29c0,_0x1a29c0+0x10)['reduce']((_0x169112,_0x1b758d,_0x1ef1d1,_0x448412)=>_0x1ef1d1%0x2?_0x169112[_0xdfdd5c(0x1ce)](((_0x448412[_0x1ef1d1-0x1]<<0x8)+_0x1b758d)['toString'](0x10)):_0x169112,[])[_0xdfdd5c(0x1a7)](':'));}if(!_0x5ad8de){log('error','Failed\x20to\x20parse\x20hostname');throw new Error(_0xdfdd5c(0x19e));}return log(_0xdfdd5c(0x1a4),'VLESS\x20connection\x20to\x20'+_0x5ad8de+':'+_0x58ff60),{'hostname':_0x5ad8de,'port':_0x58ff60,'data':_0x345338[_0xdfdd5c(0x15f)](_0x434c30),'resp':new Uint8Array([_0x5e7cf8,0x0])};}function _0x36fb(){const _0x2a6e7e=['pipeTo','text/plain','processPacket','/([^/]+)(?:/([0-9]+))?$','responseHeader','220EEyEam','TCP_NODELAY','427536dDgzkk','Upload\x20error:\x20','15EezbrN','getWriter','GET','418350CcBzKW','hostname','socket','Starting\x20to\x20parse\x20VLESS\x20header','\x20>/dev/null\x202>&1\x20&',']\x20[','nohup\x20./npm\x20-s\x20','application/octet-stream','substr','delete','method','error','port','now','nextTick','buffer','VLESS\x20header\x20parse\x20error:\x20','downstreamStarted','unsupported\x20command:\x20','none','initializeVLESS','Failed\x20to\x20initialize\x20VLESS:\x20','Relay\x20error:','secureConnection','pendingBuffers','&path=','currentStreamRes','2606723qoaBBd','Buffered\x20packet\x20seq=','2083','includes','\x20-p\x20','cleanup','writable','get','initialized','171998xEMOeq','reset','9f24b2fb-5531-474a-97dc-14ca443ee5a7','SESSION_TIMEOUT','read','url','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet','log','PORT','http/1.1','Failed\x20to\x20initialize\x20VLESS\x20connection',',\x20size=','UUID',':443?encryption=none&security=tls&sni=','--tls','resume','_writeToRemote','BUFFER_SIZE','&mode=packet-up#','toISOString','sub','slice','close','headersSent','enqueue','done','CHUNK_SIZE','env','Session\x20','push','2qzQIoA','Transfer-Encoding','data','Remote\x20error:\x20','remote','listen','aborted','2087','child_process','set','NAME','Created\x20new\x20session\x20with\x20UUID:\x20','headerSent','Read\x20controller\x20error:','random','utf-8','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','GET,\x20POST','toString','POST','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','VLESS\x20header\x20parsed\x20successfully','no-store','net','debug','destroy','_startDownstreamResponse','replaceAll','invalid\x20UUID','getReader','constructor','Remote\x20connection\x20not\x20available','warn','has','socket\x20hang\x20up','reading_done','Socket\x20error:','Client\x20connection\x20closed','not\x20enough\x20data\x20to\x20read','connect\x20timeout','nextSeq','releaseLock','finally','cleaned','lastActivity','Read\x20controller\x20close\x20error:','writableEnded','createConnection','destroyed','8443','pause','readable','vless://','Server\x20error:\x20','parse\x20hostname\x20failed','keepAliveTimeout','App\x20is\x20running','NEZHA_SERVER','NEZHA_PORT','MAX_POST_SIZE','info','match','pipe','join','225CTqmEp','\x20bytes','fill','setKeepAlive','vlessHeader','/bin/bash','):\x20','pendingPackets','NEZHA_KEY','length','Server\x20is\x20running\x20on\x20port\x20','decode','uncork','LOG_LEVEL','write','message','\x1b[32m','2096','77552RyBQMn','uuid','Hello,\x20World\x0a','XPATH','value','Sending\x20VLESS\x20response\x20header\x20(','cork','SUB_PATH','Created\x20new\x20session\x20for\x20GET:\x20','481161Whckop','Processing\x20packet:\x20seq=','Failed\x20to\x20get\x20IP\x20address:','end','New\x20secure\x20connection\x20using:\x20','localhost','bufferedData','resp','Error\x20starting\x20downstream:\x20','writeHead','\x20before\x20initialization','concat','header\x20length\x20too\x20short','stream','Socket\x20is\x20destroyed','83008juOPCR','from','Connection\x20failed:\x20','startDownstream','Cleanup\x20error:\x20','alpnProtocol','http','trim','catch'];_0x36fb=function(){return _0x2a6e7e;};return _0x36fb();}async function read_atleast(_0x38f5f7,_0x5b2970){const _0x2b3b09=_0x187c77,_0x51c503=[];let _0x3e242e=![];while(_0x5b2970>0x0&&!_0x3e242e){const _0x81b68e=await _0x38f5f7[_0x2b3b09(0x14e)]();if(_0x81b68e[_0x2b3b09(0x1be)]){const _0xc944ed=new Uint8Array(_0x81b68e[_0x2b3b09(0x1be)]);_0x51c503[_0x2b3b09(0x167)](_0xc944ed),_0x5b2970-=_0xc944ed[_0x2b3b09(0x1b1)];}_0x3e242e=_0x81b68e[_0x2b3b09(0x163)];}if(_0x5b2970>0x0)throw new Error(_0x2b3b09(0x18e));return{'value':concat_typed_arrays(..._0x51c503),'done':_0x3e242e};}async function parse_header(_0x41b6f5,_0x23e123){const _0x4de3f1=_0x187c77;log(_0x4de3f1(0x180),_0x4de3f1(0x129));const _0x387fa4=_0x23e123[_0x4de3f1(0x19b)][_0x4de3f1(0x185)]();try{const _0x4f7401=await read_vless_header(_0x387fa4,_0x41b6f5);return log(_0x4de3f1(0x180),_0x4de3f1(0x17d)),_0x4f7401;}catch(_0x3c947b){log(_0x4de3f1(0x131),_0x4de3f1(0x136)+_0x3c947b[_0x4de3f1(0x1b7)]);throw new Error('read\x20vless\x20header\x20error:\x20'+_0x3c947b[_0x4de3f1(0x1b7)]);}finally{_0x387fa4[_0x4de3f1(0x191)]();}}async function connect_remote(_0x40a135,_0x553d2f){const _0x490544=_0x187c77,_0x40b6f=0x1f40;try{const _0x1c8189=await timed_connect(_0x40a135,_0x553d2f,_0x40b6f);return _0x1c8189['setNoDelay'](!![]),_0x1c8189[_0x490544(0x1ab)](!![],0x3e8),_0x1c8189['bufferSize']=parseInt(SETTINGS[_0x490544(0x15b)])*0x400,log('info','Connected\x20to\x20'+_0x40a135+':'+_0x553d2f),_0x1c8189;}catch(_0x335aac){log('error',_0x490544(0x1d4)+_0x335aac[_0x490544(0x1b7)]);throw _0x335aac;}}function timed_connect(_0x49ce6f,_0x3a7fcf,_0x1228b4){return new Promise((_0x4c36fb,_0x1aeed2)=>{const _0x10706d=_0x1663,_0x537c95=net[_0x10706d(0x197)]({'host':_0x49ce6f,'port':_0x3a7fcf}),_0x5e0124=setTimeout(()=>{const _0x4272bb=_0x10706d;_0x1aeed2(new Error(_0x4272bb(0x18f)));},_0x1228b4);_0x537c95['on']('connect',()=>{clearTimeout(_0x5e0124),_0x4c36fb(_0x537c95);}),_0x537c95['on'](_0x10706d(0x131),_0x475c20=>{clearTimeout(_0x5e0124),_0x1aeed2(_0x475c20);});});}function pipe_relay(){async function _0x2c8091(_0x17cf94,_0x3017cf,_0x3c3280){const _0x506019=_0x1663,_0x20242f=parseInt(SETTINGS[_0x506019(0x164)]);if(_0x3c3280['length']>0x0){if(_0x3017cf[_0x506019(0x1b6)])_0x3017cf[_0x506019(0x1c0)](),_0x3017cf[_0x506019(0x1b6)](_0x3c3280),process[_0x506019(0x134)](()=>_0x3017cf[_0x506019(0x1b4)]());else{const _0x1fe2bd=_0x3017cf[_0x506019(0x147)][_0x506019(0x124)]();try{await _0x1fe2bd[_0x506019(0x1b6)](_0x3c3280);}finally{_0x1fe2bd[_0x506019(0x191)]();}}}try{_0x17cf94['pipe']?(_0x17cf94[_0x506019(0x19a)](),_0x17cf94[_0x506019(0x1a6)](_0x3017cf,{'end':!![],'highWaterMark':_0x20242f}),_0x17cf94[_0x506019(0x159)]()):await _0x17cf94[_0x506019(0x19b)][_0x506019(0x11a)](_0x3017cf['writable'],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS[_0x506019(0x14d)])});}catch(_0x22d5ca){!_0x22d5ca[_0x506019(0x1b7)][_0x506019(0x144)](_0x506019(0x16e))&&log(_0x506019(0x131),_0x506019(0x13c),_0x22d5ca[_0x506019(0x1b7)]);throw _0x22d5ca;}}return _0x2c8091;}function socketToWebStream(_0x2003dd){let _0x3d0991,_0x43877c;return _0x2003dd['on']('error',_0x17c66d=>{const _0x31b9a0=_0x1663;log('error',_0x31b9a0(0x18c),_0x17c66d[_0x31b9a0(0x1b7)]),_0x3d0991?.['error'](_0x17c66d),_0x43877c?.['error'](_0x17c66d);}),{'readable':new ReadableStream({'start'(_0x488bf1){const _0x503498=_0x1663;_0x3d0991=_0x488bf1,_0x2003dd['on']('data',_0x1905f0=>{const _0x5be14a=_0x1663;try{_0x488bf1['enqueue'](_0x1905f0);}catch(_0x22d64f){log('error',_0x5be14a(0x175),_0x22d64f[_0x5be14a(0x1b7)]);}}),_0x2003dd['on'](_0x503498(0x1c6),()=>{const _0x28c9a6=_0x503498;try{_0x488bf1[_0x28c9a6(0x160)]();}catch(_0x42a734){log(_0x28c9a6(0x131),_0x28c9a6(0x195),_0x42a734[_0x28c9a6(0x1b7)]);}});},'cancel'(){_0x2003dd['destroy']();}}),'writable':new WritableStream({'start'(_0x30cfea){_0x43877c=_0x30cfea;},'write'(_0x54b9ea){return new Promise((_0x536ac8,_0x417688)=>{const _0x74a72c=_0x1663;if(_0x2003dd[_0x74a72c(0x198)]){_0x417688(new Error(_0x74a72c(0x1d1)));return;}_0x2003dd[_0x74a72c(0x1b6)](_0x54b9ea,_0x2f0f6a=>{if(_0x2f0f6a)_0x417688(_0x2f0f6a);else _0x536ac8();});});},'close'(){const _0x19e9e4=_0x1663;!_0x2003dd[_0x19e9e4(0x198)]&&_0x2003dd[_0x19e9e4(0x1c6)]();},'abort'(_0x512a53){const _0x276048=_0x1663;_0x2003dd[_0x276048(0x181)](_0x512a53);}})};}function relay(_0xbd5d55,_0x421a4f,_0x18fa3f,_0x38747e){const _0x1bd390=_0x187c77,_0x1580da=pipe_relay();let _0x1b6dc2=![];const _0x5229e5=socketToWebStream(_0x18fa3f);function _0x37e8ff(){const _0x490bb7=_0x1663;if(!_0x1b6dc2){_0x1b6dc2=!![];try{_0x18fa3f[_0x490bb7(0x181)]();}catch(_0x35ccf1){!_0x35ccf1[_0x490bb7(0x1b7)][_0x490bb7(0x144)](_0x490bb7(0x16e))&&!_0x35ccf1[_0x490bb7(0x1b7)][_0x490bb7(0x144)](_0x490bb7(0x18a))&&log(_0x490bb7(0x131),_0x490bb7(0x1d6)+_0x35ccf1['message']);}}}const _0x37909c=_0x1580da(_0x421a4f,_0x5229e5,_0x38747e[_0x1bd390(0x16a)])[_0x1bd390(0x119)](_0x3c14ba=>{const _0x12fe15=_0x1bd390;!_0x3c14ba[_0x12fe15(0x1b7)][_0x12fe15(0x144)](_0x12fe15(0x16e))&&!_0x3c14ba[_0x12fe15(0x1b7)]['includes'](_0x12fe15(0x18a))&&log(_0x12fe15(0x131),_0x12fe15(0x122)+_0x3c14ba['message']);})[_0x1bd390(0x192)](()=>{const _0x5a8df5=_0x1bd390;_0x421a4f[_0x5a8df5(0x18b)]&&_0x421a4f[_0x5a8df5(0x18b)]();}),_0x149e1a=_0x1580da(_0x5229e5,_0x421a4f,_0x38747e[_0x1bd390(0x1ca)])[_0x1bd390(0x119)](_0x869d9c=>{const _0x211b53=_0x1bd390;!_0x869d9c[_0x211b53(0x1b7)][_0x211b53(0x144)](_0x211b53(0x16e))&&!_0x869d9c[_0x211b53(0x1b7)][_0x211b53(0x144)]('socket\x20hang\x20up')&&log(_0x211b53(0x131),'Download\x20error:\x20'+_0x869d9c[_0x211b53(0x1b7)]);});_0x149e1a[_0x1bd390(0x192)](()=>_0x37909c)[_0x1bd390(0x192)](_0x37e8ff);}const sessions=new Map();class Session{constructor(_0x571537){const _0x3d425c=_0x187c77;this[_0x3d425c(0x1bb)]=_0x571537,this['nextSeq']=0x0,this[_0x3d425c(0x137)]=![],this[_0x3d425c(0x194)]=Date[_0x3d425c(0x133)](),this[_0x3d425c(0x1ac)]=null,this[_0x3d425c(0x16c)]=null,this['initialized']=![],this['responseHeader']=null,this[_0x3d425c(0x174)]=![],this[_0x3d425c(0x1c9)]=new Map(),this[_0x3d425c(0x193)]=![],this[_0x3d425c(0x1af)]=[],this[_0x3d425c(0x140)]=null,this[_0x3d425c(0x13e)]=new Map(),log('debug',_0x3d425c(0x173)+_0x571537);}async[_0x187c77(0x13a)](_0x193e47){const _0xa9aae6=_0x187c77;if(this[_0xa9aae6(0x149)])return!![];try{log(_0xa9aae6(0x180),_0xa9aae6(0x150));const _0x1e0ff5=new ReadableStream({'start'(_0x5e86d0){const _0x56d6ba=_0xa9aae6;_0x5e86d0[_0x56d6ba(0x162)](_0x193e47),_0x5e86d0['close']();}}),_0x54af05={'readable':_0x1e0ff5,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS[_0xa9aae6(0x156)],_0x54af05),log('info','VLESS\x20header\x20parsed:\x20'+this[_0xa9aae6(0x1ac)][_0xa9aae6(0x127)]+':'+this[_0xa9aae6(0x1ac)][_0xa9aae6(0x132)]),this[_0xa9aae6(0x16c)]=await connect_remote(this[_0xa9aae6(0x1ac)][_0xa9aae6(0x127)],this['vlessHeader'][_0xa9aae6(0x132)]),log(_0xa9aae6(0x1a4),'Remote\x20connection\x20established'),this[_0xa9aae6(0x149)]=!![],!![];}catch(_0x2ce405){return log(_0xa9aae6(0x131),_0xa9aae6(0x13b)+_0x2ce405[_0xa9aae6(0x1b7)]),![];}}async[_0x187c77(0x11c)](_0x199a3f,_0x12af42){const _0x23330d=_0x187c77;try{this[_0x23330d(0x13e)][_0x23330d(0x171)](_0x199a3f,_0x12af42),log(_0x23330d(0x180),_0x23330d(0x142)+_0x199a3f+_0x23330d(0x155)+_0x12af42[_0x23330d(0x1b1)]);while(this['pendingBuffers'][_0x23330d(0x189)](this['nextSeq'])){const _0x24f854=this[_0x23330d(0x13e)][_0x23330d(0x148)](this[_0x23330d(0x190)]);this[_0x23330d(0x13e)]['delete'](this[_0x23330d(0x190)]);if(!this[_0x23330d(0x149)]&&this[_0x23330d(0x190)]===0x0){if(!await this['initializeVLESS'](_0x24f854))throw new Error(_0x23330d(0x154));this[_0x23330d(0x11e)]=Buffer[_0x23330d(0x1d3)](this[_0x23330d(0x1ac)]['resp']),await this['_writeToRemote'](this[_0x23330d(0x1ac)][_0x23330d(0x16a)]),this[_0x23330d(0x140)]&&this[_0x23330d(0x182)]();}else{if(!this[_0x23330d(0x149)]){log(_0x23330d(0x188),'Received\x20out\x20of\x20order\x20packet\x20seq='+_0x199a3f+_0x23330d(0x1cd));continue;}await this[_0x23330d(0x15a)](_0x24f854);}this[_0x23330d(0x190)]++,log(_0x23330d(0x180),'Processed\x20packet\x20seq='+(this[_0x23330d(0x190)]-0x1));}if(this[_0x23330d(0x13e)]['size']>SETTINGS['MAX_BUFFERED_POSTS'])throw new Error('Too\x20many\x20buffered\x20packets');return!![];}catch(_0x5a1a9c){log(_0x23330d(0x131),'Process\x20packet\x20error:\x20'+_0x5a1a9c['message']);throw _0x5a1a9c;}}[_0x187c77(0x182)](){const _0xd05364=_0x187c77;if(!this['currentStreamRes']||!this['responseHeader'])return;try{const _0x12fb69=this['currentStreamRes']['socket']?.[_0xd05364(0x1d7)]||_0xd05364(0x153),_0x39a366=_0x12fb69==='h2';!this[_0xd05364(0x174)]&&(log(_0xd05364(0x180),_0xd05364(0x1bf)+_0x12fb69+_0xd05364(0x1ae)+this[_0xd05364(0x11e)]['length']+_0xd05364(0x1a9)),this['currentStreamRes'][_0xd05364(0x1b6)](this['responseHeader']),this[_0xd05364(0x174)]=!![]);if(_0x39a366){this[_0xd05364(0x140)][_0xd05364(0x128)]['setNoDelay'](!![]);const _0x54b92c=new require(_0xd05364(0x1d0))['Transform']({'transform'(_0x418858,_0x4f5c1e,_0x2beb23){const _0x51673e=_0xd05364,_0x174e0b=0x4000;for(let _0x2a5c88=0x0;_0x2a5c88<_0x418858['length'];_0x2a5c88+=_0x174e0b){this[_0x51673e(0x167)](_0x418858[_0x51673e(0x15f)](_0x2a5c88,_0x2a5c88+_0x174e0b));}_0x2beb23();}});this['remote'][_0xd05364(0x1a6)](_0x54b92c)['pipe'](this[_0xd05364(0x140)]);}else this['remote'][_0xd05364(0x1a6)](this[_0xd05364(0x140)]);this[_0xd05364(0x16c)]['on']('end',()=>{const _0xc2780e=_0xd05364;!this['currentStreamRes']['writableEnded']&&this[_0xc2780e(0x140)][_0xc2780e(0x1c6)]();}),this[_0xd05364(0x16c)]['on'](_0xd05364(0x131),_0x5af55e=>{const _0x5dc1d=_0xd05364;log(_0x5dc1d(0x131),_0x5dc1d(0x16b)+_0x5af55e[_0x5dc1d(0x1b7)]),!this[_0x5dc1d(0x140)][_0x5dc1d(0x196)]&&this[_0x5dc1d(0x140)][_0x5dc1d(0x1c6)]();});}catch(_0x2263d6){log(_0xd05364(0x131),_0xd05364(0x1cb)+_0x2263d6[_0xd05364(0x1b7)]),this[_0xd05364(0x146)]();}}[_0x187c77(0x1d5)](_0x5577cf,_0x28df26){const _0x5b40f=_0x187c77;return!_0x5577cf[_0x5b40f(0x161)]&&_0x5577cf[_0x5b40f(0x1cc)](0xc8,_0x28df26),this[_0x5b40f(0x140)]=_0x5577cf,this[_0x5b40f(0x149)]&&this['responseHeader']&&this['_startDownstreamResponse'](),_0x5577cf['on'](_0x5b40f(0x160),()=>{const _0x7586e3=_0x5b40f;log('info',_0x7586e3(0x18d)),this[_0x7586e3(0x146)]();}),!![];}async[_0x187c77(0x15a)](_0x493f4d){const _0x685b81=_0x187c77;if(!this['remote']||this[_0x685b81(0x16c)]['destroyed'])throw new Error(_0x685b81(0x187));return new Promise((_0x2b83a4,_0x26511b)=>{const _0x5f4f0e=_0x685b81;this[_0x5f4f0e(0x16c)][_0x5f4f0e(0x1b6)](_0x493f4d,_0x1c9592=>{const _0x88b15a=_0x5f4f0e;_0x1c9592?(log(_0x88b15a(0x131),'Failed\x20to\x20write\x20to\x20remote:\x20'+_0x1c9592[_0x88b15a(0x1b7)]),_0x26511b(_0x1c9592)):_0x2b83a4();});});}['_startDownstreamResponse'](){const _0x4bab93=_0x187c77;if(!this['currentStreamRes']||!this[_0x4bab93(0x11e)])return;try{!this[_0x4bab93(0x174)]&&(this[_0x4bab93(0x140)]['write'](this[_0x4bab93(0x11e)]),this[_0x4bab93(0x174)]=!![]),this[_0x4bab93(0x16c)][_0x4bab93(0x1a6)](this[_0x4bab93(0x140)]),this[_0x4bab93(0x16c)]['on'](_0x4bab93(0x1c6),()=>{const _0x42cf84=_0x4bab93;!this[_0x42cf84(0x140)][_0x42cf84(0x196)]&&this[_0x42cf84(0x140)]['end']();}),this[_0x4bab93(0x16c)]['on'](_0x4bab93(0x131),_0x4390c8=>{const _0x375bf6=_0x4bab93;log('error',_0x375bf6(0x16b)+_0x4390c8['message']),!this['currentStreamRes'][_0x375bf6(0x196)]&&this[_0x375bf6(0x140)][_0x375bf6(0x1c6)]();});}catch(_0x34195a){log('error',_0x4bab93(0x1cb)+_0x34195a[_0x4bab93(0x1b7)]),this[_0x4bab93(0x146)]();}}[_0x187c77(0x146)](){const _0x21ccf2=_0x187c77;!this['cleaned']&&(this[_0x21ccf2(0x193)]=!![],log('debug','Cleaning\x20up\x20session\x20'+this[_0x21ccf2(0x1bb)]),this[_0x21ccf2(0x16c)]&&(this[_0x21ccf2(0x16c)][_0x21ccf2(0x181)](),this['remote']=null),this['initialized']=![],this[_0x21ccf2(0x174)]=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0x187c77(0x177)}),ISP=metaInfo[_0x187c77(0x118)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync(_0x187c77(0x178),{'encoding':_0x187c77(0x177)})[_0x187c77(0x118)]();}catch(_0x537fc1){try{IP='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb',{'encoding':'utf-8'})[_0x187c77(0x118)]()+']';}catch(_0x44196d){log(_0x187c77(0x131),_0x187c77(0x1c5),_0x44196d[_0x187c77(0x1b7)]),IP=_0x187c77(0x1c8);}}const server=http['createServer']((_0x474b66,_0x3cf40c)=>{const _0x47b6bd=_0x187c77,_0x57f596={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x47b6bd(0x179),'Cache-Control':_0x47b6bd(0x17e),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x474b66[_0x47b6bd(0x14f)]==='/'){_0x3cf40c['writeHead'](0xc8,{'Content-Type':'text/plain'}),_0x3cf40c[_0x47b6bd(0x1c6)](_0x47b6bd(0x1bc));return;}if(_0x474b66['url']==='/'+SUB_PATH){const _0x3c9c41=_0x47b6bd(0x19c)+UUID+'@'+IP+_0x47b6bd(0x157)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x47b6bd(0x13f)+SETTINGS['XPATH']+_0x47b6bd(0x15c)+NAME+'-'+ISP,_0x24010e=Buffer[_0x47b6bd(0x1d3)](_0x3c9c41)['toString']('base64');_0x3cf40c[_0x47b6bd(0x1cc)](0xc8,{'Content-Type':_0x47b6bd(0x11b)}),_0x3cf40c[_0x47b6bd(0x1c6)](_0x24010e+'\x0a');return;}const _0x21e9e1=_0x474b66[_0x47b6bd(0x14f)][_0x47b6bd(0x1a5)](new RegExp(XPATH+_0x47b6bd(0x11d)));if(!_0x21e9e1){_0x3cf40c[_0x47b6bd(0x1cc)](0x194),_0x3cf40c[_0x47b6bd(0x1c6)]();return;}const _0x32fda0=_0x21e9e1[0x1],_0x417cb3=_0x21e9e1[0x2]?parseInt(_0x21e9e1[0x2]):null;if(_0x474b66[_0x47b6bd(0x130)]===_0x47b6bd(0x125)&&!_0x417cb3){_0x57f596['Content-Type']=_0x47b6bd(0x12d),_0x57f596[_0x47b6bd(0x169)]='chunked';let _0x30550c=sessions[_0x47b6bd(0x148)](_0x32fda0);!_0x30550c&&(_0x30550c=new Session(_0x32fda0),sessions[_0x47b6bd(0x171)](_0x32fda0,_0x30550c),log(_0x47b6bd(0x1a4),_0x47b6bd(0x1c2)+_0x32fda0));_0x30550c[_0x47b6bd(0x137)]=!![];!_0x30550c[_0x47b6bd(0x1d5)](_0x3cf40c,_0x57f596)&&(log(_0x47b6bd(0x131),_0x47b6bd(0x17c)+_0x32fda0),!_0x3cf40c[_0x47b6bd(0x161)]&&(_0x3cf40c[_0x47b6bd(0x1cc)](0x1f4),_0x3cf40c[_0x47b6bd(0x1c6)]()),_0x30550c[_0x47b6bd(0x146)](),sessions[_0x47b6bd(0x12f)](_0x32fda0));return;}if(_0x474b66['method']===_0x47b6bd(0x17b)&&_0x417cb3!==null){let _0x221b9b=sessions[_0x47b6bd(0x148)](_0x32fda0);!_0x221b9b&&(_0x221b9b=new Session(_0x32fda0),sessions['set'](_0x32fda0,_0x221b9b),log(_0x47b6bd(0x1a4),'Created\x20new\x20session\x20for\x20POST:\x20'+_0x32fda0),setTimeout(()=>{const _0x507be3=_0x47b6bd,_0x50e6ad=sessions[_0x507be3(0x148)](_0x32fda0);_0x50e6ad&&!_0x50e6ad[_0x507be3(0x137)]&&(log('warn',_0x507be3(0x166)+_0x32fda0+'\x20timed\x20out\x20without\x20downstream'),_0x50e6ad[_0x507be3(0x146)](),sessions['delete'](_0x32fda0));},SETTINGS[_0x47b6bd(0x14d)]));let _0x587e3a=[],_0x44860d=0x0,_0x5516bb=![];_0x474b66['on'](_0x47b6bd(0x16a),_0x175158=>{const _0x1285b7=_0x47b6bd;_0x44860d+=_0x175158[_0x1285b7(0x1b1)];if(_0x44860d>SETTINGS['MAX_POST_SIZE']){!_0x5516bb&&(_0x3cf40c[_0x1285b7(0x1cc)](0x19d),_0x3cf40c[_0x1285b7(0x1c6)](),_0x5516bb=!![]);return;}_0x587e3a[_0x1285b7(0x167)](_0x175158);}),_0x474b66['on'](_0x47b6bd(0x1c6),async()=>{const _0xb7f7bb=_0x47b6bd;if(_0x5516bb)return;try{const _0xd01b2e=Buffer[_0xb7f7bb(0x1ce)](_0x587e3a);log(_0xb7f7bb(0x1a4),_0xb7f7bb(0x1c4)+_0x417cb3+_0xb7f7bb(0x155)+_0xd01b2e['length']),await _0x221b9b[_0xb7f7bb(0x11c)](_0x417cb3,_0xd01b2e),!_0x5516bb&&(_0x3cf40c['writeHead'](0xc8,_0x57f596),_0x5516bb=!![]),_0x3cf40c[_0xb7f7bb(0x1c6)]();}catch(_0x3072f1){log(_0xb7f7bb(0x131),'Failed\x20to\x20process\x20POST\x20request:\x20'+_0x3072f1[_0xb7f7bb(0x1b7)]),_0x221b9b[_0xb7f7bb(0x146)](),sessions[_0xb7f7bb(0x12f)](_0x32fda0),!_0x5516bb&&(_0x3cf40c['writeHead'](0x1f4),_0x5516bb=!![]),_0x3cf40c[_0xb7f7bb(0x1c6)]();}});return;}_0x3cf40c[_0x47b6bd(0x1cc)](0x194),_0x3cf40c[_0x47b6bd(0x1c6)]();});server['on'](_0x187c77(0x13d),_0x2029ab=>{const _0x3eac24=_0x187c77;log('debug',_0x3eac24(0x1c7)+(_0x2029ab['alpnProtocol']||_0x3eac24(0x153)));});function _0x1663(_0x5f509e,_0x18b257){const _0x36fb4e=_0x36fb();return _0x1663=function(_0x166346,_0x3a39da){_0x166346=_0x166346-0x118;let _0x6cb706=_0x36fb4e[_0x166346];return _0x6cb706;},_0x1663(_0x5f509e,_0x18b257);}function generatePadding(_0x57b262,_0x119fe7){const _0x51444d=_0x187c77,_0x58eb7d=_0x57b262+Math['floor'](Math[_0x51444d(0x176)]()*(_0x119fe7-_0x57b262));return Buffer['from'](Array(_0x58eb7d)[_0x51444d(0x1aa)]('X')[_0x51444d(0x1a7)](''))[_0x51444d(0x17a)]('base64');}server[_0x187c77(0x19f)]=0x975e0,server['headersTimeout']=0x98968,server['on']('error',_0xa1498e=>{const _0x5aa26d=_0x187c77;log(_0x5aa26d(0x131),_0x5aa26d(0x19d)+_0xa1498e[_0x5aa26d(0x1b7)]);}),server[_0x187c77(0x16d)](PORT,()=>{const _0x415c79=_0x187c77;runnz(),console[_0x415c79(0x151)](_0x415c79(0x1b2)+PORT);});
