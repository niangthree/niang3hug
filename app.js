const _0x31bb85=_0x5401;(function(_0x11a53d,_0x5dff51){const _0x20d02b=_0x5401,_0x2923c5=_0x11a53d();while(!![]){try{const _0x568ec2=parseInt(_0x20d02b(0x174))/0x1+parseInt(_0x20d02b(0x12f))/0x2+-parseInt(_0x20d02b(0x177))/0x3+parseInt(_0x20d02b(0x135))/0x4+parseInt(_0x20d02b(0x102))/0x5*(-parseInt(_0x20d02b(0x155))/0x6)+-parseInt(_0x20d02b(0x115))/0x7+-parseInt(_0x20d02b(0xc7))/0x8;if(_0x568ec2===_0x5dff51)break;else _0x2923c5['push'](_0x2923c5['shift']());}catch(_0x438f3c){_0x2923c5['push'](_0x2923c5['shift']());}}}(_0x4f81,0x216f1));const net=require(_0x31bb85(0x165)),http=require(_0x31bb85(0x144)),{Buffer}=require(_0x31bb85(0x139)),{execSync}=require(_0x31bb85(0xfb)),UUID=process[_0x31bb85(0xfc)]['UUID']||_0x31bb85(0x191),SUB_PATH=process[_0x31bb85(0xfc)][_0x31bb85(0xf4)]||_0x31bb85(0x183),XPATH=process[_0x31bb85(0xfc)][_0x31bb85(0x16e)]||UUID[_0x31bb85(0xe9)](0x0,0x8),DOMAIN=process[_0x31bb85(0xfc)][_0x31bb85(0x10c)]||'niangthree-fenchattp.hf.space',NAME=process[_0x31bb85(0xfc)][_0x31bb85(0xdf)]||'Hf',PORT=process[_0x31bb85(0xfc)][_0x31bb85(0x14a)]||0x1eb4,SETTINGS={'UUID':UUID,'LOG_LEVEL':_0x31bb85(0xf3),'BUFFER_SIZE':0x400,'XPATH':'%2F'+XPATH,'MAX_BUFFERED_POSTS':0x1e,'MAX_POST_SIZE':0xf4240,'SESSION_TIMEOUT':0x7530,'CHUNK_SIZE':0x400*0x400,'TCP_NODELAY':!![],'TCP_KEEPALIVE':!![]};function validate_uuid(_0x4e8d2c,_0x3dfa0e){const _0x196055=_0x31bb85;if(_0x4e8d2c[_0x196055(0x10a)]!==0x10||_0x3dfa0e[_0x196055(0x10a)]!==0x10)return![];for(let _0x3d9c6e=0x0;_0x3d9c6e<0x10;_0x3d9c6e++){if(_0x4e8d2c[_0x3d9c6e]!==_0x3dfa0e[_0x3d9c6e])return![];}return!![];}function concat_typed_arrays(_0x33415c,..._0x41dfaa){const _0x4daa59=_0x31bb85;if(!_0x41dfaa||_0x41dfaa['length']<0x1)return _0x33415c;let _0x44fd7b=_0x33415c[_0x4daa59(0x10a)];for(const _0xdbde01 of _0x41dfaa)_0x44fd7b+=_0xdbde01['length'];const _0xeb58dc=new _0x33415c[(_0x4daa59(0x103))](_0x44fd7b);_0xeb58dc[_0x4daa59(0x175)](_0x33415c,0x0);let _0x57f3e6=_0x33415c[_0x4daa59(0x10a)];for(const _0x193748 of _0x41dfaa){_0xeb58dc[_0x4daa59(0x175)](_0x193748,_0x57f3e6),_0x57f3e6+=_0x193748[_0x4daa59(0x10a)];}return _0xeb58dc;}function log(_0x2f4ea8,..._0x409d3f){const _0xda26b4=_0x31bb85;if(SETTINGS[_0xda26b4(0x161)]===_0xda26b4(0xf7))return;const _0x59c952={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x34af54={'debug':'\x1b[36m','info':_0xda26b4(0xf2),'warn':_0xda26b4(0x117),'error':_0xda26b4(0x116),'reset':_0xda26b4(0x140)},_0x54e4af=_0x59c952[SETTINGS[_0xda26b4(0x161)]]||0x1,_0xc35faa=_0x59c952[_0x2f4ea8]||0x0;if(_0xc35faa>=_0x54e4af){const _0x58b6e4=new Date()[_0xda26b4(0x15b)](),_0x216ef3=_0x34af54[_0x2f4ea8]||_0x34af54[_0xda26b4(0x14b)];console[_0xda26b4(0x101)](_0x216ef3+'['+_0x58b6e4+_0xda26b4(0x105)+_0x2f4ea8['toUpperCase']()+']',..._0x409d3f,_0x34af54['reset']);}}function parse_uuid(_0x446820){const _0xde2f9d=_0x31bb85,_0x3b70db=_0x446820[_0xde2f9d(0xcd)]('-',''),_0x5b7cfd=new Uint8Array(0x10);for(let _0x3e36e3=0x0;_0x3e36e3<0x10;_0x3e36e3++){_0x5b7cfd[_0x3e36e3]=parseInt(_0x3b70db[_0xde2f9d(0xe1)](_0x3e36e3*0x2,_0x3e36e3*0x2+0x2),0x10);}return _0x5b7cfd;}async function read_atleast(_0x47f040,_0x394cc9){const _0x3f3887=_0x31bb85,_0x288595=[];let _0x3c667c=0x0,_0x2f5613=![];while(_0x3c667c<_0x394cc9&&!_0x2f5613){const {value:_0x279270,done:_0x588946}=await _0x47f040[_0x3f3887(0x114)]();_0x279270&&(_0x288595[_0x3f3887(0xc3)](new Uint8Array(_0x279270)),_0x3c667c+=_0x279270[_0x3f3887(0x10a)]),_0x2f5613=_0x588946;}if(_0x3c667c<_0x394cc9)throw new Error(_0x3f3887(0x170)+_0x394cc9+'\x20but\x20got\x20'+_0x3c667c);return{'value':concat_typed_arrays(..._0x288595),'done':_0x2f5613};}async function read_vless_header(_0x53e5a2,_0x3b67b5){const _0x384516=_0x31bb85;let _0x3c11ed=new Uint8Array(),_0x300c65=0x0;async function _0x5096e9(_0x5812ae){const _0x2e6da6=_0x5401,_0x352247=_0x5812ae-_0x300c65;if(_0x352247<=0x0)return;const {value:_0x3bd6d0,done:_0x5030c6}=await read_atleast(_0x53e5a2,_0x352247);if(_0x5030c6&&_0x3bd6d0['length']<_0x352247)throw new Error(_0x2e6da6(0xe5));_0x3c11ed=concat_typed_arrays(_0x3c11ed,_0x3bd6d0),_0x300c65+=_0x3bd6d0[_0x2e6da6(0x10a)];}await _0x5096e9(0x1+0x10+0x1);const _0x32fe9b=_0x3c11ed[0x0],_0x39525a=_0x3c11ed[_0x384516(0xe9)](0x1,0x11),_0x3d0bd0=parse_uuid(_0x3b67b5);if(!validate_uuid(_0x39525a,_0x3d0bd0))throw new Error('invalid\x20UUID:\x20'+Array['from'](_0x39525a)['map'](_0x3f54ab=>_0x3f54ab['toString'](0x10)[_0x384516(0x121)](0x2,'0'))[_0x384516(0xc5)](''));const _0x4d6cc7=_0x3c11ed[0x11],_0x36ea10=0x1+0x10+0x1+_0x4d6cc7;await _0x5096e9(_0x36ea10+0x1+0x2+0x1);const _0x4ad6fa=_0x3c11ed[_0x36ea10],_0x36ed2f=0x1;if(_0x4ad6fa!==_0x36ed2f)throw new Error(_0x384516(0xf5)+_0x4ad6fa);const _0x1ecb55=_0x36ea10+0x1,_0x1f8b34=(_0x3c11ed[_0x1ecb55]<<0x8)+_0x3c11ed[_0x1ecb55+0x1],_0x1b86dc=_0x3c11ed[_0x1ecb55+0x2];let _0xe06c6e=-0x1;const _0xd963b=0x1,_0x44b6bf=0x2,_0x107c9d=0x3,_0x49767d=_0x1ecb55+0x3;if(_0x1b86dc===_0xd963b)_0xe06c6e=_0x49767d+0x4;else{if(_0x1b86dc===_0x107c9d)_0xe06c6e=_0x49767d+0x10;else{if(_0x1b86dc===_0x44b6bf){await _0x5096e9(_0x49767d+0x1);const _0x49786d=_0x3c11ed[_0x49767d];_0xe06c6e=_0x49767d+0x1+_0x49786d;}else throw new Error('unsupported\x20address\x20type:\x20'+_0x1b86dc);}}await _0x5096e9(_0xe06c6e);let _0x3f1d5e='';if(_0x1b86dc===_0xd963b)_0x3f1d5e=_0x3c11ed['slice'](_0x49767d,_0xe06c6e)['join']('.');else{if(_0x1b86dc===_0x44b6bf){const _0x3d1c46=_0x3c11ed[_0x49767d];_0x3f1d5e=new TextDecoder()[_0x384516(0x173)](_0x3c11ed[_0x384516(0xe9)](_0x49767d+0x1,_0x49767d+0x1+_0x3d1c46));}else _0x1b86dc===_0x107c9d&&(_0x3f1d5e=_0x3c11ed[_0x384516(0xe9)](_0x49767d,_0xe06c6e)['reduce']((_0x182507,_0x20a085,_0x2b3896,_0x5d4254)=>_0x2b3896%0x2?_0x182507[_0x384516(0xf1)](((_0x5d4254[_0x2b3896-0x1]<<0x8)+_0x20a085)[_0x384516(0xd2)](0x10)):_0x182507,[])['join'](':'));}if(!_0x3f1d5e){log('error',_0x384516(0x171));throw new Error(_0x384516(0xe8));}return log('info',_0x384516(0x152)+_0x3f1d5e+':'+_0x1f8b34),{'hostname':_0x3f1d5e,'port':_0x1f8b34,'data':_0x3c11ed[_0x384516(0xe9)](_0xe06c6e),'resp':new Uint8Array([_0x32fe9b,0x0])};}async function parse_header(_0x31e864,_0x29b097){const _0x1bedd7=_0x31bb85;log(_0x1bedd7(0x100),_0x1bedd7(0x14d));const _0x4bb70d=_0x29b097[_0x1bedd7(0x141)][_0x1bedd7(0xf8)]();try{const _0x24f18a=await read_vless_header(_0x4bb70d,_0x31e864);return log(_0x1bedd7(0x100),_0x1bedd7(0x10d)),_0x24f18a;}catch(_0x214001){log(_0x1bedd7(0x106),_0x1bedd7(0x131)+_0x214001[_0x1bedd7(0xdb)]);throw new Error(_0x1bedd7(0xd3)+_0x214001[_0x1bedd7(0xdb)]);}finally{_0x4bb70d[_0x1bedd7(0xc9)]();}}function timed_connect(_0x893c4c,_0x2ba6f0,_0x54aee4){return new Promise((_0x2f8ae7,_0x2dc203)=>{const _0x5a0436=_0x5401,_0x1d474e=net[_0x5a0436(0x14f)]({'host':_0x893c4c,'port':_0x2ba6f0}),_0x5ea569=setTimeout(()=>{const _0x52ed30=_0x5a0436;_0x1d474e['destroy'](new Error(_0x52ed30(0x113)+_0x893c4c+':'+_0x2ba6f0)),_0x2dc203(new Error(_0x52ed30(0x113)+_0x893c4c+':'+_0x2ba6f0));},_0x54aee4);_0x1d474e['on'](_0x5a0436(0x15e),()=>{clearTimeout(_0x5ea569),_0x2f8ae7(_0x1d474e);}),_0x1d474e['on'](_0x5a0436(0x106),_0x4416fd=>{const _0x19a1c0=_0x5a0436;clearTimeout(_0x5ea569),_0x2dc203(new Error('connect\x20error\x20to\x20'+_0x893c4c+':'+_0x2ba6f0+':\x20'+_0x4416fd[_0x19a1c0(0xdb)]));}),_0x1d474e['on'](_0x5a0436(0xcc),()=>{clearTimeout(_0x5ea569);});});}async function connect_remote(_0x2d3d13,_0x48dff7){const _0x1264f5=_0x31bb85,_0x3d7785=0x1f40;try{const _0x1e41b0=await timed_connect(_0x2d3d13,_0x48dff7,_0x3d7785);return _0x1e41b0['setNoDelay'](SETTINGS[_0x1264f5(0x104)]),_0x1e41b0[_0x1264f5(0xce)](SETTINGS['TCP_KEEPALIVE'],0x3e8),log(_0x1264f5(0xf3),_0x1264f5(0x162)+_0x2d3d13+':'+_0x48dff7),_0x1e41b0;}catch(_0x2f38cc){log(_0x1264f5(0x106),_0x1264f5(0x153)+_0x2d3d13+':'+_0x48dff7+':\x20'+_0x2f38cc[_0x1264f5(0xdb)]);throw _0x2f38cc;}}function pipe_relay(){async function _0x319a35(_0x28f497,_0x2a83a9,_0x382aa1){const _0x118c6b=_0x5401,_0x1bec50=SETTINGS['CHUNK_SIZE'];if(_0x382aa1&&_0x382aa1['length']>0x0){if(_0x2a83a9 instanceof net[_0x118c6b(0xc6)])_0x2a83a9[_0x118c6b(0x194)](),_0x2a83a9[_0x118c6b(0x17c)](_0x382aa1),process[_0x118c6b(0x185)](()=>_0x2a83a9[_0x118c6b(0x13e)]());else{const _0xc8ea7f=_0x2a83a9[_0x118c6b(0x157)][_0x118c6b(0x112)]();try{await _0xc8ea7f[_0x118c6b(0x17c)](_0x382aa1);}finally{_0xc8ea7f[_0x118c6b(0xc9)]();}}}try{if(_0x28f497 instanceof net[_0x118c6b(0xc6)]&&_0x2a83a9 instanceof net[_0x118c6b(0xc6)])_0x28f497[_0x118c6b(0x13f)](_0x2a83a9,{'end':!![]});else{if(_0x28f497['readable']&&_0x2a83a9[_0x118c6b(0x157)])await _0x28f497[_0x118c6b(0x141)]['pipeTo'](_0x2a83a9[_0x118c6b(0x157)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal[_0x118c6b(0x196)](SETTINGS[_0x118c6b(0x186)])});else throw new Error(_0x118c6b(0xd8));}}catch(_0x16dfed){!_0x16dfed['message'][_0x118c6b(0xc4)](_0x118c6b(0x182))&&!_0x16dfed[_0x118c6b(0xdb)]['includes'](_0x118c6b(0x15a))&&!_0x16dfed[_0x118c6b(0xdb)][_0x118c6b(0xc4)](_0x118c6b(0x159))&&log(_0x118c6b(0x106),_0x118c6b(0x12c),_0x16dfed[_0x118c6b(0xdb)]);throw _0x16dfed;}}return _0x319a35;}function socketToWebStream(_0x2651a5){let _0xbb5d0b,_0x264344;const _0xf7ef1a=new ReadableStream({'start'(_0x115d77){const _0x5ab5f9=_0x5401;_0xbb5d0b=_0x115d77,_0x2651a5['on'](_0x5ab5f9(0xfa),_0x3c26b7=>{const _0x4ed71=_0x5ab5f9;try{_0x115d77[_0x4ed71(0x166)](_0x3c26b7);}catch(_0x256dc){log(_0x4ed71(0x106),_0x4ed71(0x13a),_0x256dc[_0x4ed71(0xdb)]),!_0x115d77[_0x4ed71(0xd9)]&&_0x2651a5[_0x4ed71(0x136)]();}}),_0x2651a5['on'](_0x5ab5f9(0x14e),()=>{const _0x4a8f93=_0x5ab5f9;log(_0x4a8f93(0x100),_0x4a8f93(0x149));try{_0x115d77[_0x4a8f93(0xcc)]();}catch(_0x1b48be){log(_0x4a8f93(0x106),_0x4a8f93(0x10b),_0x1b48be['message']);}}),_0x2651a5['on'](_0x5ab5f9(0x106),_0x1eca02=>{const _0x596b0b=_0x5ab5f9;log(_0x596b0b(0x106),'Socket\x20error\x20on\x20readable\x20stream:',_0x1eca02[_0x596b0b(0xdb)]),_0x115d77[_0x596b0b(0x106)](_0x1eca02);});},'cancel'(_0x1f21d9){const _0x3b042a=_0x5401;log(_0x3b042a(0x100),_0x3b042a(0x16a),_0x1f21d9),_0x2651a5['destroy'](_0x1f21d9);}}),_0x3d0acc=new WritableStream({'start'(_0x5d7968){_0x264344=_0x5d7968,_0x2651a5['on']('error',_0x500f41=>{const _0x3522bc=_0x5401;log(_0x3522bc(0x106),_0x3522bc(0x109),_0x500f41[_0x3522bc(0xdb)]),_0x5d7968[_0x3522bc(0x106)](_0x500f41);});},async 'write'(_0x56ae07){return new Promise((_0x5b6cce,_0x1151af)=>{const _0x108210=_0x5401;if(_0x2651a5[_0x108210(0x15c)]||_0x2651a5[_0x108210(0x17b)])return _0x1151af(new Error(_0x108210(0x138)));_0x2651a5[_0x108210(0x17c)](_0x56ae07,_0x2a5525=>{const _0x5b27a4=_0x108210;_0x2a5525?(log(_0x5b27a4(0x106),_0x5b27a4(0x11c),_0x2a5525[_0x5b27a4(0xdb)]),_0x1151af(_0x2a5525)):_0x5b6cce();});});},'close'(){const _0x4864fd=_0x5401;log(_0x4864fd(0x100),_0x4864fd(0xeb)),!_0x2651a5[_0x4864fd(0x15c)]&&_0x2651a5[_0x4864fd(0x14e)]();},'abort'(_0x5435d2){const _0x48a16a=_0x5401;log(_0x48a16a(0x108),_0x48a16a(0x12e),_0x5435d2),_0x2651a5[_0x48a16a(0x136)](_0x5435d2);}});return{'readable':_0xf7ef1a,'writable':_0x3d0acc};}function relay(_0x4a8b5d,_0x591ebd,_0x279eb2,_0x34e56e){const _0x4d8f2a=_0x31bb85,_0xab8eda=pipe_relay();let _0x150594=![];const _0xa3391=socketToWebStream(_0x279eb2),_0xe6c453=()=>{const _0x4e4e85=_0x5401;if(!_0x150594){_0x150594=!![],log('debug',_0x4e4e85(0x134));try{_0x279eb2&&!_0x279eb2[_0x4e4e85(0x15c)]&&(_0x279eb2[_0x4e4e85(0x136)](),log(_0x4e4e85(0x100),'Remote\x20socket\x20destroyed\x20during\x20cleanup.'));}catch(_0x17f9d7){!_0x17f9d7[_0x4e4e85(0xdb)]['includes'](_0x4e4e85(0x182))&&!_0x17f9d7[_0x4e4e85(0xdb)][_0x4e4e85(0xc4)](_0x4e4e85(0x15a))&&!_0x17f9d7['message']['includes'](_0x4e4e85(0x159))&&log(_0x4e4e85(0x106),'Error\x20during\x20relay\x20cleanup:\x20'+_0x17f9d7['message']);}}},_0x14e013=_0xab8eda(_0x591ebd,_0xa3391,_0x34e56e['data'])[_0x4d8f2a(0x142)](_0x58f83e=>{const _0x4f33a7=_0x4d8f2a;!_0x58f83e[_0x4f33a7(0xdb)]['includes'](_0x4f33a7(0x182))&&!_0x58f83e[_0x4f33a7(0xdb)]['includes'](_0x4f33a7(0x15a))&&!_0x58f83e[_0x4f33a7(0xdb)][_0x4f33a7(0xc4)](_0x4f33a7(0x159))&&log(_0x4f33a7(0x106),_0x4f33a7(0x148)+_0x58f83e[_0x4f33a7(0xdb)]);})['finally'](()=>{const _0x86ccea=_0x4d8f2a;_0x591ebd['reading_done']&&_0x591ebd[_0x86ccea(0x147)](),_0xe6c453();}),_0x4100af=_0xab8eda(_0xa3391,_0x591ebd,_0x34e56e[_0x4d8f2a(0x130)])[_0x4d8f2a(0x142)](_0xb1110=>{const _0x4af1eb=_0x4d8f2a;!_0xb1110[_0x4af1eb(0xdb)][_0x4af1eb(0xc4)]('aborted')&&!_0xb1110[_0x4af1eb(0xdb)][_0x4af1eb(0xc4)](_0x4af1eb(0x15a))&&!_0xb1110[_0x4af1eb(0xdb)]['includes']('ERR_STREAM_PREMATURE_CLOSE')&&log(_0x4af1eb(0x106),_0x4af1eb(0xde)+_0xb1110[_0x4af1eb(0xdb)]);})[_0x4d8f2a(0xcf)](()=>{_0xe6c453();});Promise['allSettled']([_0x14e013,_0x4100af])[_0x4d8f2a(0xcf)](()=>{const _0x1cc8e9=_0x4d8f2a;log(_0x1cc8e9(0x100),_0x1cc8e9(0x167)),_0xe6c453();});}class Session{constructor(_0x42a1a6){const _0xef3ab8=_0x31bb85;this[_0xef3ab8(0x150)]=_0x42a1a6,this['nextSeq']=0x0,this[_0xef3ab8(0x111)]=![],this[_0xef3ab8(0xec)]=Date['now'](),this['vlessHeader']=null,this[_0xef3ab8(0x192)]=null,this[_0xef3ab8(0x181)]=![],this[_0xef3ab8(0xbf)]=null,this[_0xef3ab8(0x13c)]=![],this[_0xef3ab8(0xd1)]=new Map(),this[_0xef3ab8(0xee)]=![],this[_0xef3ab8(0x128)]=null,log(_0xef3ab8(0x100),_0xef3ab8(0xf6)+_0x42a1a6);}async['initializeVLESS'](_0x3c7517){const _0x2b080f=_0x31bb85;if(this[_0x2b080f(0x181)])return!![];log(_0x2b080f(0x100),_0x2b080f(0x16b));const _0x344616=new ReadableStream({'start'(_0x538d6a){_0x538d6a['enqueue'](_0x3c7517),_0x538d6a['close']();}}),_0x3beef8={'readable':_0x344616,'writable':new WritableStream()};try{return this[_0x2b080f(0x190)]=await parse_header(SETTINGS['UUID'],_0x3beef8),log('info',_0x2b080f(0x172)+this[_0x2b080f(0x150)]+':\x20'+this[_0x2b080f(0x190)][_0x2b080f(0x11b)]+':'+this[_0x2b080f(0x190)]['port']),this[_0x2b080f(0x192)]=await connect_remote(this[_0x2b080f(0x190)][_0x2b080f(0x11b)],this[_0x2b080f(0x190)][_0x2b080f(0x160)]),log(_0x2b080f(0xf3),_0x2b080f(0x107)+this[_0x2b080f(0x150)]),this[_0x2b080f(0x181)]=!![],this[_0x2b080f(0xbf)]=Buffer[_0x2b080f(0x124)](this['vlessHeader']['resp']),await this[_0x2b080f(0x146)](this[_0x2b080f(0x190)][_0x2b080f(0xfa)]),this['currentStreamRes']&&this[_0x2b080f(0x193)](),!![];}catch(_0x1793cf){return log(_0x2b080f(0x106),_0x2b080f(0x15f)+this[_0x2b080f(0x150)]+':\x20'+_0x1793cf[_0x2b080f(0xdb)]),this['cleanup'](),![];}}async[_0x31bb85(0x195)](_0x19bfaa,_0x53bc1f){const _0x2c11fa=_0x31bb85;this[_0x2c11fa(0xec)]=Date['now']();try{this['pendingBuffers'][_0x2c11fa(0x175)](_0x19bfaa,_0x53bc1f),log(_0x2c11fa(0x100),_0x2c11fa(0xc2)+_0x19bfaa+_0x2c11fa(0xed)+_0x53bc1f[_0x2c11fa(0x10a)]+_0x2c11fa(0xdc)+this['uuid']);while(this['pendingBuffers'][_0x2c11fa(0x189)](this[_0x2c11fa(0x127)])){const _0x1bbd0c=this[_0x2c11fa(0xd1)][_0x2c11fa(0x11d)](this[_0x2c11fa(0x127)]);this['pendingBuffers'][_0x2c11fa(0x126)](this[_0x2c11fa(0x127)]);if(!this[_0x2c11fa(0x181)]){if(this[_0x2c11fa(0x127)]===0x0){if(!await this[_0x2c11fa(0xd7)](_0x1bbd0c))throw new Error(_0x2c11fa(0x180));}else{log('warn','Received\x20out\x20of\x20order\x20packet\x20seq='+this[_0x2c11fa(0x127)]+_0x2c11fa(0xc8)+this['uuid']+_0x2c11fa(0x122)),this[_0x2c11fa(0xd6)]();throw new Error(_0x2c11fa(0x178));}}else await this['_writeToRemote'](_0x1bbd0c);this[_0x2c11fa(0x127)]++,log('debug',_0x2c11fa(0x12a)+(this[_0x2c11fa(0x127)]-0x1)+_0x2c11fa(0xdc)+this[_0x2c11fa(0x150)]+'.');}if(this[_0x2c11fa(0xd1)][_0x2c11fa(0x156)]>SETTINGS[_0x2c11fa(0x15d)]){log(_0x2c11fa(0x106),_0x2c11fa(0xca)+this[_0x2c11fa(0x150)]+_0x2c11fa(0x18c)+SETTINGS[_0x2c11fa(0x15d)]),this[_0x2c11fa(0xd6)]();throw new Error(_0x2c11fa(0xe4));}return!![];}catch(_0x1e5f02){log(_0x2c11fa(0x106),'Error\x20processing\x20packet\x20seq='+_0x19bfaa+_0x2c11fa(0xdc)+this[_0x2c11fa(0x150)]+':\x20'+_0x1e5f02[_0x2c11fa(0xdb)]),this[_0x2c11fa(0xd6)]();throw _0x1e5f02;}}[_0x31bb85(0xe2)](_0x658014,_0x5e26f4){const _0x596960=_0x31bb85;if(this[_0x596960(0x128)])return log(_0x596960(0x108),_0x596960(0x16d)+this[_0x596960(0x150)]+'.\x20New\x20request\x20ignored.'),![];return!_0x658014[_0x596960(0x18f)]&&_0x658014[_0x596960(0x12d)](0xc8,_0x5e26f4),this[_0x596960(0x128)]=_0x658014,this[_0x596960(0x111)]=!![],this[_0x596960(0xec)]=Date[_0x596960(0x154)](),this[_0x596960(0x181)]&&this[_0x596960(0xbf)]&&this[_0x596960(0x193)](),_0x658014['on'](_0x596960(0xcc),()=>{const _0x146e79=_0x596960;log(_0x146e79(0xf3),_0x146e79(0x145)+this[_0x146e79(0x150)]),this['cleanup'](),sessions['delete'](this[_0x146e79(0x150)]);}),_0x658014['on'](_0x596960(0x106),_0x2ac0f6=>{const _0x37d940=_0x596960;log(_0x37d940(0x106),_0x37d940(0x10e)+this[_0x37d940(0x150)]+':\x20'+_0x2ac0f6[_0x37d940(0xdb)]),this[_0x37d940(0xd6)](),sessions['delete'](this['uuid']);}),!![];}async['_writeToRemote'](_0x19603b){const _0x21fe7c=_0x31bb85;if(!this[_0x21fe7c(0x192)]||this[_0x21fe7c(0x192)][_0x21fe7c(0x15c)]){const _0x4dc017=_0x21fe7c(0x118)+this[_0x21fe7c(0x150)];log('error',_0x4dc017);throw new Error(_0x4dc017);}return new Promise((_0x180daa,_0x3c4493)=>{const _0x279df6=_0x21fe7c;this[_0x279df6(0x192)]['write'](_0x19603b,_0x5eaf78=>{const _0x33e8b6=_0x279df6;_0x5eaf78?(log(_0x33e8b6(0x106),_0x33e8b6(0xfd)+_0x19603b[_0x33e8b6(0x10a)]+'\x20bytes\x20to\x20remote\x20for\x20session\x20'+this['uuid']+':\x20'+_0x5eaf78[_0x33e8b6(0xdb)]),_0x3c4493(_0x5eaf78)):_0x180daa();});});}[_0x31bb85(0x193)](){const _0x470f52=_0x31bb85;if(!this['currentStreamRes']||!this[_0x470f52(0x192)]||this[_0x470f52(0x13c)]){log(_0x470f52(0x108),_0x470f52(0x120)+this['uuid']+_0x470f52(0x14c));return;}try{this[_0x470f52(0x128)][_0x470f52(0x17c)](this[_0x470f52(0xbf)]),this[_0x470f52(0x13c)]=!![],log(_0x470f52(0x100),_0x470f52(0xfe)+this[_0x470f52(0x150)]+'.'),this[_0x470f52(0x192)][_0x470f52(0x13f)](this[_0x470f52(0x128)]),this[_0x470f52(0x192)]['on'](_0x470f52(0x14e),()=>{const _0x5e2a53=_0x470f52;log(_0x5e2a53(0xf3),_0x5e2a53(0xe7)+this[_0x5e2a53(0x150)]+'.'),!this[_0x5e2a53(0x128)][_0x5e2a53(0x17b)]&&this[_0x5e2a53(0x128)]['end']();}),this['remote']['on']('error',_0x1a1432=>{const _0x1c42d9=_0x470f52;log(_0x1c42d9(0x106),_0x1c42d9(0x18b)+this[_0x1c42d9(0x150)]+':\x20'+_0x1a1432[_0x1c42d9(0xdb)]),!this[_0x1c42d9(0x128)][_0x1c42d9(0x17b)]&&this[_0x1c42d9(0x128)][_0x1c42d9(0x14e)](),this[_0x1c42d9(0xd6)]();});}catch(_0x42e1c3){log(_0x470f52(0x106),_0x470f52(0x17d)+this[_0x470f52(0x150)]+':\x20'+_0x42e1c3[_0x470f52(0xdb)]),this[_0x470f52(0xd6)]();}}['cleanup'](){const _0x4a76fc=_0x31bb85;!this[_0x4a76fc(0xee)]&&(this[_0x4a76fc(0xee)]=!![],log(_0x4a76fc(0xf3),_0x4a76fc(0x143)+this['uuid']),this['remote']&&(this[_0x4a76fc(0x192)][_0x4a76fc(0x136)](),this[_0x4a76fc(0x192)]=null),this['pendingBuffers'][_0x4a76fc(0xcb)](),this[_0x4a76fc(0x181)]=![],this['headerSent']=![],this[_0x4a76fc(0x128)]=null,log('debug','Session\x20'+this[_0x4a76fc(0x150)]+_0x4a76fc(0xd4)));}}const sessions=new Map(),metaInfo=execSync(_0x31bb85(0x197),{'encoding':'utf-8'})[_0x31bb85(0x132)](),ISP=metaInfo;function _0x4f81(){const _0x162043=['Readable\x20stream\x20cancelled,\x20destroying\x20socket.','Initializing\x20VLESS\x20connection\x20from\x20first\x20packet',':443?encryption=none&security=tls&sni=','Downstream\x20already\x20started\x20for\x20session\x20','XPATH','no-cache','not\x20enough\x20data\x20to\x20read,\x20expected\x20','Failed\x20to\x20parse\x20hostname\x20from\x20VLESS\x20header.','VLESS\x20header\x20parsed\x20for\x20session\x20','decode','214057brHyuP','set','Payload\x20Too\x20Large','174207uYVFsn','Out\x20of\x20order\x20packet\x20before\x20session\x20initialization.','Created\x20new\x20session\x20for\x20POST\x20(upstream):\x20','Request\x20stream\x20error\x20for\x20session\x20','writableEnded','write','Error\x20initiating\x20downstream\x20response\x20for\x20session\x20','text/plain','Session\x20','Failed\x20to\x20initialize\x20VLESS\x20connection\x20with\x20first\x20packet.','initialized','aborted','sub','GET','nextTick','SESSION_TIMEOUT','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789','entries','has','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','Remote\x20socket\x20error\x20for\x20session\x20','.\x20Max:\x20','GET,\x20POST,\x20OPTIONS','New\x20secure\x20connection\x20established.\x20ALPN:\x20','headersSent','vlessHeader','ea58ceb6-c772-4b72-8262-7911c54c0358','remote','_startDownstreamResponse','cork','processPacket','timeout','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','createServer','responseHeader','method','DENY','Buffered\x20packet\x20seq=','push','includes','join','Socket','1106600CrrNQj','\x20before\x20initialization\x20for\x20session\x20','releaseLock','Too\x20many\x20buffered\x20packets\x20for\x20session\x20','clear','close','replaceAll','setKeepAlive','finally','Internal\x20Server\x20Error','pendingBuffers','toString','read\x20vless\x20header\x20error:\x20','\x20cleaned\x20up.','base64','cleanup','initializeVLESS','Unsupported\x20stream\x20types\x20for\x20piping','desiredSize','Invalid\x20URL\x20path:\x20','message','\x20for\x20session\x20','listen','Data\x20download\x20error:\x20','NAME','alpnProtocol','substring','startDownstream','secureConnection','Too\x20many\x20buffered\x20packets,\x20session\x20terminated.','header\x20length\x20too\x20short\x20or\x20stream\x20ended\x20prematurely','Hello,\x20World\x0a','Remote\x20socket\x20ended\x20for\x20session\x20','parse\x20hostname\x20failed','slice','Reusing\x20existing\x20session\x20for\x20POST\x20(upstream):\x20','Writable\x20stream\x20closed,\x20ending\x20socket.','lastActivity',',\x20size=','cleaned','Not\x20Found','HTTP\x20Server\x20error:\x20','concat','\x1b[32m','info','SUB_PATH','unsupported\x20command\x20type:\x20','Created\x20new\x20session\x20with\x20UUID:\x20','none','getReader','charAt','data','child_process','env','Failed\x20to\x20write\x20','Sent\x20VLESS\x20response\x20header\x20for\x20session\x20','keepAliveTimeout','debug','log','15710hAgZLf','constructor','TCP_NODELAY',']\x20[','error','Remote\x20connection\x20established\x20for\x20session\x20','warn','Socket\x20error\x20on\x20writable\x20stream:','length','Error\x20closing\x20readable\x20stream\x20controller:','DOMAIN','VLESS\x20header\x20parsed\x20successfully','Client\x20response\x20stream\x20error\x20for\x20session\x20','no-referrer-when-downgrade','POST','downstreamStarted','getWriter','connect\x20timeout\x20to\x20','read','460908gshSws','\x1b[31m','\x1b[33m','Remote\x20connection\x20not\x20available\x20or\x20destroyed\x20for\x20session\x20','floor','Created\x20new\x20session\x20for\x20GET\x20(downstream):\x20','hostname','Socket\x20write\x20error:','get','application/octet-stream','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','Attempted\x20to\x20start\x20downstream\x20response\x20for\x20session\x20','padStart','.\x20Data\x20dropped.','Failed\x20to\x20get\x20IP\x20address\x20from\x20both\x20IPv4\x20and\x20IPv6\x20services:','from','OPTIONS','delete','nextSeq','currentStreamRes','Failed\x20to\x20process\x20POST\x20request\x20for\x20session\x20','Processed\x20packet\x20seq=','&fp=chrome&allowInsecure=1&type=xhttp&host=','Relay\x20pump\x20error:','writeHead','Writable\x20stream\x20aborted,\x20destroying\x20socket.','297762ymVTMg','resp','VLESS\x20header\x20parse\x20error:\x20','trim','random','Initiating\x20relay\x20cleanup.','170116MYtkpA','destroy','Reusing\x20existing\x20session\x20for\x20GET\x20(downstream):\x20','Socket\x20is\x20destroyed\x20or\x20already\x20ended.','buffer','Error\x20enqueuing\x20data\x20to\x20readable\x20stream:','http/1.1','headerSent','default-src\x20\x27self\x27','uncork','pipe','\x1b[0m','readable','catch','Cleaning\x20up\x20session\x20','http','Client\x20connection\x20closed\x20for\x20session\x20','_writeToRemote','reading_done','Data\x20upload\x20error:\x20','Socket\x20readable\x20ended.','PORT','reset','\x20but\x20conditions\x20not\x20met.','Starting\x20to\x20parse\x20VLESS\x20header','end','createConnection','uuid','Server\x20is\x20listening\x20on\x20port\x20','VLESS\x20connection\x20to\x20','Failed\x20to\x20connect\x20to\x20remote\x20','now','12ZDNqNf','size','writable','localhost','ERR_STREAM_PREMATURE_CLOSE','socket\x20hang\x20up','toISOString','destroyed','MAX_BUFFERED_POSTS','connect','Failed\x20to\x20initialize\x20VLESS\x20for\x20session\x20','port','LOG_LEVEL','Successfully\x20connected\x20to\x20remote\x20','url','utf-8','net','enqueue','Both\x20relay\x20streams\x20settled,\x20final\x20cleanup.','nosniff','&path='];_0x4f81=function(){return _0x162043;};return _0x4f81();}let IP=DOMAIN;if(!DOMAIN)try{IP=execSync('curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb',{'encoding':_0x31bb85(0x164)})[_0x31bb85(0x132)]();}catch(_0x3b381f){log(_0x31bb85(0x108),'Failed\x20to\x20get\x20IPv4\x20address,\x20trying\x20IPv6:',_0x3b381f[_0x31bb85(0xdb)]);try{IP='['+execSync(_0x31bb85(0x18a),{'encoding':_0x31bb85(0x164)})['trim']()+']';}catch(_0x4154fc){log('error',_0x31bb85(0x123),_0x4154fc['message']),IP=_0x31bb85(0x158);}}function _0x5401(_0x13d640,_0x51178b){const _0x4f81e1=_0x4f81();return _0x5401=function(_0x54012d,_0x55f711){_0x54012d=_0x54012d-0xbe;let _0x23a15a=_0x4f81e1[_0x54012d];return _0x23a15a;},_0x5401(_0x13d640,_0x51178b);}function setupSessionCleanupTimer(){const _0x56b6c3=_0x31bb85;setInterval(()=>{const _0x49de36=_0x5401,_0x4ed9cc=Date[_0x49de36(0x154)]();for(const [_0xe401d7,_0x161e9c]of sessions[_0x49de36(0x188)]()){(!_0x161e9c[_0x49de36(0x111)]&&_0x4ed9cc-_0x161e9c[_0x49de36(0xec)]>SETTINGS[_0x49de36(0x186)]||_0x161e9c[_0x49de36(0x111)]&&_0x4ed9cc-_0x161e9c[_0x49de36(0xec)]>SETTINGS['SESSION_TIMEOUT']*0x2)&&(log('warn',_0x49de36(0x17f)+_0xe401d7+'\x20timed\x20out\x20or\x20inactive,\x20cleaning\x20up.'),_0x161e9c[_0x49de36(0xd6)](),sessions[_0x49de36(0x126)](_0xe401d7));}},SETTINGS[_0x56b6c3(0x186)]/0x2);}const server=http[_0x31bb85(0xbe)]((_0x1fccf5,_0x568926)=>{const _0x942a43=_0x31bb85,_0x19ce68={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':_0x942a43(0x18d),'Cache-Control':'no-store,\x20no-cache,\x20must-revalidate,\x20proxy-revalidate','Pragma':_0x942a43(0x16f),'Expires':'0','X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8),'Content-Security-Policy':_0x942a43(0x13d),'X-Content-Type-Options':_0x942a43(0x168),'X-Frame-Options':_0x942a43(0xc1),'Referrer-Policy':_0x942a43(0x10f)};if(_0x1fccf5[_0x942a43(0xc0)]===_0x942a43(0x125)){_0x568926[_0x942a43(0x12d)](0xcc,_0x19ce68),_0x568926[_0x942a43(0x14e)]();return;}if(_0x1fccf5[_0x942a43(0x163)]==='/'){_0x568926[_0x942a43(0x12d)](0xc8,{..._0x19ce68,'Content-Type':_0x942a43(0x17e)}),_0x568926[_0x942a43(0x14e)](_0x942a43(0xe6));return;}if(_0x1fccf5['url']==='/'+SUB_PATH){const _0x47931e='vless://'+UUID+'@'+IP+_0x942a43(0x16c)+IP+_0x942a43(0x12b)+IP+_0x942a43(0x169)+SETTINGS[_0x942a43(0x16e)]+'&mode=packet-up#'+NAME+'-'+ISP,_0x51913b=Buffer[_0x942a43(0x124)](_0x47931e)[_0x942a43(0xd2)]('base64');_0x568926['writeHead'](0xc8,{..._0x19ce68,'Content-Type':_0x942a43(0x17e)}),_0x568926[_0x942a43(0x14e)](_0x51913b+'\x0a');return;}const _0x359bb6=_0x1fccf5[_0x942a43(0x163)]['match'](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x359bb6){log(_0x942a43(0x108),_0x942a43(0xda)+_0x1fccf5[_0x942a43(0x163)]),_0x568926[_0x942a43(0x12d)](0x194,_0x19ce68),_0x568926[_0x942a43(0x14e)](_0x942a43(0xef));return;}const _0x4812fc=_0x359bb6[0x1],_0xc7b259=_0x359bb6[0x2]?parseInt(_0x359bb6[0x2]):null;if(_0x1fccf5[_0x942a43(0xc0)]===_0x942a43(0x184)&&_0xc7b259===null){const _0x4cda9c={..._0x19ce68,'Content-Type':_0x942a43(0x11e),'Transfer-Encoding':'chunked'};let _0x1291f8=sessions[_0x942a43(0x11d)](_0x4812fc);!_0x1291f8?(_0x1291f8=new Session(_0x4812fc),sessions[_0x942a43(0x175)](_0x4812fc,_0x1291f8),log('info',_0x942a43(0x11a)+_0x4812fc)):log(_0x942a43(0xf3),_0x942a43(0x137)+_0x4812fc);!_0x1291f8[_0x942a43(0xe2)](_0x568926,_0x4cda9c)&&(log(_0x942a43(0x106),_0x942a43(0x11f)+_0x4812fc),!_0x568926['headersSent']&&(_0x568926[_0x942a43(0x12d)](0x1f4,_0x19ce68),_0x568926[_0x942a43(0x14e)]('Internal\x20Server\x20Error')),_0x1291f8[_0x942a43(0xd6)](),sessions[_0x942a43(0x126)](_0x4812fc));return;}if(_0x1fccf5[_0x942a43(0xc0)]===_0x942a43(0x110)&&_0xc7b259!==null){let _0x5f317a=sessions[_0x942a43(0x11d)](_0x4812fc);!_0x5f317a?(_0x5f317a=new Session(_0x4812fc),sessions['set'](_0x4812fc,_0x5f317a),log(_0x942a43(0xf3),_0x942a43(0x179)+_0x4812fc)):log(_0x942a43(0xf3),_0x942a43(0xea)+_0x4812fc);let _0x1ed6c7=[],_0x515849=0x0,_0x4e09be=![];_0x1fccf5['on'](_0x942a43(0xfa),_0x2e3e68=>{const _0x4aa483=_0x942a43;_0x515849+=_0x2e3e68['length'];if(_0x515849>SETTINGS['MAX_POST_SIZE']){!_0x4e09be&&(_0x568926[_0x4aa483(0x12d)](0x19d,_0x19ce68),_0x568926['end'](_0x4aa483(0x176)),_0x4e09be=!![]);_0x1fccf5[_0x4aa483(0x136)]();return;}_0x1ed6c7[_0x4aa483(0xc3)](_0x2e3e68);}),_0x1fccf5['on'](_0x942a43(0x14e),async()=>{const _0x1bd40f=_0x942a43;if(_0x4e09be)return;try{const _0x1bbd6c=Buffer[_0x1bd40f(0xf1)](_0x1ed6c7);log(_0x1bd40f(0xf3),'Received\x20POST\x20packet:\x20seq='+_0xc7b259+_0x1bd40f(0xed)+_0x1bbd6c['length']+_0x1bd40f(0xdc)+_0x4812fc),await _0x5f317a[_0x1bd40f(0x195)](_0xc7b259,_0x1bbd6c),!_0x4e09be&&(_0x568926[_0x1bd40f(0x12d)](0xc8,_0x19ce68),_0x568926['end']('OK'),_0x4e09be=!![]);}catch(_0x5ae194){log(_0x1bd40f(0x106),_0x1bd40f(0x129)+_0x4812fc+':\x20'+_0x5ae194[_0x1bd40f(0xdb)]),_0x5f317a['cleanup'](),sessions[_0x1bd40f(0x126)](_0x4812fc),!_0x4e09be&&(_0x568926['writeHead'](0x1f4,_0x19ce68),_0x568926[_0x1bd40f(0x14e)](_0x1bd40f(0xd0)),_0x4e09be=!![]);}}),_0x1fccf5['on']('error',_0x27f8d3=>{const _0x564fd2=_0x942a43;log(_0x564fd2(0x106),_0x564fd2(0x17a)+_0x4812fc+':\x20'+_0x27f8d3['message']),!_0x4e09be&&(_0x568926[_0x564fd2(0x12d)](0x1f4,_0x19ce68),_0x568926[_0x564fd2(0x14e)](_0x564fd2(0xd0)),_0x4e09be=!![]),_0x5f317a[_0x564fd2(0xd6)](),sessions['delete'](_0x4812fc);});return;}log('warn','Unhandled\x20request\x20method/path:\x20'+_0x1fccf5['method']+'\x20'+_0x1fccf5[_0x942a43(0x163)]),_0x568926['writeHead'](0x194,_0x19ce68),_0x568926['end'](_0x942a43(0xef));});server['on'](_0x31bb85(0xe3),_0x3cc5ed=>{const _0x28a12f=_0x31bb85;log(_0x28a12f(0x100),_0x28a12f(0x18e)+(_0x3cc5ed[_0x28a12f(0xe0)]||_0x28a12f(0x13b)));});function generatePadding(_0x158104,_0x48614e){const _0x248d1d=_0x31bb85,_0x4290b3=_0x158104+Math[_0x248d1d(0x119)](Math[_0x248d1d(0x133)]()*(_0x48614e-_0x158104+0x1)),_0x3ce957=_0x248d1d(0x187);let _0x22740a='';for(let _0x523ade=0x0;_0x523ade<_0x4290b3;_0x523ade++){_0x22740a+=_0x3ce957[_0x248d1d(0xf9)](Math[_0x248d1d(0x119)](Math[_0x248d1d(0x133)]()*_0x3ce957['length']));}return Buffer[_0x248d1d(0x124)](_0x22740a)[_0x248d1d(0xd2)](_0x248d1d(0xd5));}server[_0x31bb85(0xff)]=0x26c*0x3e8,server['headersTimeout']=0x271*0x3e8,server['on'](_0x31bb85(0x106),_0x138f83=>{const _0x4f16b8=_0x31bb85;log('error',_0x4f16b8(0xf0)+_0x138f83['message']);}),server[_0x31bb85(0xdd)](PORT,()=>{const _0x25da64=_0x31bb85;log(_0x25da64(0xf3),_0x25da64(0x151)+PORT),setupSessionCleanupTimer();});
